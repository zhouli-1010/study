<!DOCTYPE html>
<!-- saved from url=(0058)https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html -->
<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  

  <title>Java8 — Bootcamp ServerSide Intermediate - latest</title>
  <link rel="stylesheet" href="./Java8_files/normalize.css" type="text/css">
  <link rel="stylesheet" href="./Java8_files/basic.css" type="text/css">
  <link rel="stylesheet" href="./Java8_files/pygments.css" type="text/css">
  <link rel="stylesheet" href="./Java8_files/solomon.css" type="text/css">
  <link rel="index" title="索引" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/genindex.html">
  <link rel="search" title="検索" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/search.html">
  <link rel="top" title="Bootcamp ServerSide Intermediate - latest" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/index.html">
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:    '',
      VERSION:     'latest',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE:  true
    };
  </script>
  <script type="text/javascript" src="./Java8_files/jquery.js.ダウンロード"></script>
  <script type="text/javascript" src="./Java8_files/underscore.js.ダウンロード"></script>
  <script type="text/javascript" src="./Java8_files/doctools.js.ダウンロード"></script>
  <script type="text/javascript" src="./Java8_files/translations.js.ダウンロード"></script>
  <script src="./Java8_files/MathJax.js.ダウンロード" id=""></script>
  <script type="text/javascript" src="./Java8_files/solomon.js.ダウンロード"></script>
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
<body><div id="MathJax_Message" style="display: none;"></div><header id="global-header" class="both-side">
  <div class="left">
      <div class="vcenter">
        <a href="https://webootcamp.worksap.co.jp/course/ss-i/ja/index.html">
          <img src="./Java8_files/bootcamp-logo.png" class="bland-logo">
        </a>
      </div>
      <div class="vcenter">
        <a href="https://webootcamp.worksap.co.jp/course/ss-i/ja/index.html" class="master-link">
          <h1>Bootcamp ServerSide Intermediate - latest</h1>
        </a>
      </div>
    
  </div>
  
  <div class="right">
    <nav class="vcenter">
      <ul class="rellinks">
<li>
    日本語
  </li>
<li>
    <a href="https://webootcamp.worksap.co.jp/course/ss-i/en/java8.html">
    
    English
    </a>
    
  </li>
        <li>
          <a href="https://webootcamp.worksap.co.jp/course/ss-i/ja/genindex.html" title="総合索引" accesskey="I">索引</a>
        </li>
      </ul>
    </nav>
  </div>
</header>
  <div class="both-side main-layout">
    <div class="left"><nav class="related-nav" aria-label="related navigation">

  <ul class="breadcrumb-list">
    <li>
      <a href="https://webootcamp.worksap.co.jp/course/ss-i/ja/index.html">Bootcamp ServerSide Intermediate - latest</a>
    </li>
  </ul>

</nav>
      <main>
  <div class="section" id="java8">
<h1>Java8<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#java8" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>ここでは、Java8の主要機能として、ラムダ式およびStream APIの学習を行います。</p>
<div class="section" id="id1">
<h2>ラムダ式<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>まずはJava 8の目玉機能、「ラムダ式」についての学習を行います。</p>
<p>そもそもラムダ式とはなんぞや、という話は長くなるので割愛しますが、
Javaにおけるラムダ式とは、１つのインターフェイスに実装しなければならない１つのメソッドを持つインターフェイス（これを関数型インターフェイスと言います）を実装する際の構文糖衣として捉えることが出来ます。</p>
<p>関数型インターフェイスとして比較的馴染みが深いのは、
Collections.sort()で利用するComparatorでしょう。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">descendingComparator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Integer</span> <span class="n">o1</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">o2</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o1</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">};</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">numbers</span><span class="o">);</span> <span class="c1">// [4, 15, 3, 0]</span>
<span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">numbers</span><span class="o">,</span> <span class="n">descendingComparator</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">numbers</span><span class="o">);</span> <span class="c1">// [15, 4, 3, 0]</span>
</pre></div>
</div>
<p>リストを順番に並び替えたいだけなのに、匿名クラスを作成し、冗長なコードを大量に書かなければなりません。
Java 8のラムダ式は、この冗長な表現をシンプルに記述することに役立ちます。</p>
<p>Comparatorの実装クラスはcompare()だけ実装すれば良いので、Comparatorは関数型インターフェイスです。関数型インターフェイスに対しては、次の構文で簡略化することが出来ます。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">descendingComparator</span> <span class="o">=</span> <span class="o">(</span><span class="n">o1</span><span class="o">,</span> <span class="n">o2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">o2</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o1</span><span class="o">);</span>
<span class="o">};</span>
</pre></div>
</div>
<p>右辺には、引数のo1、o2がIntegerであること、戻り値がIntegerであること、メソッド名がcompare()であることが一切書かれていません。これはコンパイラが自動的に判定してくれます。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>次のように、引数の型を手動で指定しても構いません（たまにIDEが型推論に失敗することもあり、その時に便利です）。</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">descendingComparator</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">o1</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">o2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">o2</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o1</span><span class="o">);</span>
<span class="o">};</span>
</pre></div>
</div>
</div>
<p>さらに、メソッドの実装が唯一のreturn文のみである場合、次のように簡略化することが出来ます。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">descendingComparator</span> <span class="o">=</span> <span class="o">(</span><span class="n">o1</span><span class="o">,</span> <span class="n">o2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">o2</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o1</span><span class="o">);</span>
</pre></div>
</div>
<p>ラムダ式は、一旦変数に代入せずに、直接関数の引数に渡しても構いません。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">numbers</span><span class="o">);</span> <span class="c1">// [4, 15, 3, 0]</span>
<span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">numbers</span><span class="o">,</span> <span class="o">(</span><span class="n">o1</span><span class="o">,</span> <span class="n">o2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">o2</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o1</span><span class="o">));</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">numbers</span><span class="o">);</span> <span class="c1">// [15, 4, 3, 0]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>なお、引数が１つの場合、()は不要です。次の２つのラムダ式は同じです。</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">fn1</span> <span class="o">=</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
<span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">fn2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>ラムダ式の書き方・発展編<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>関数に引数をそのまま受け渡すだけの場合は、</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%">
<col width="32%">
<col width="32%">
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Before</td>
<td>After</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">x</span> <span class="pre">-&gt;</span> <span class="pre">Foo.foo(x)</span></code></td>
<td><code class="docutils literal"><span class="pre">Foo::foo</span></code></td>
<td>(static method)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">x</span> <span class="pre">-&gt;</span> <span class="pre">x.foo(x)</span></code></td>
<td><code class="docutils literal"><span class="pre">X::foo</span></code></td>
<td>(instance method)</td>
</tr>
</tbody>
</table>
<p>と書くことが出来ます。</p>
<div class="section" id="id3">
<h4>例<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id3" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">));</span>
</pre></div>
</div>
<p>は次と等価です。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</pre></div>
</div>
<p>また、</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%">
<col width="32%">
<col width="32%">
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Before</td>
<td>After</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">()</span> <span class="pre">-&gt;</span> <span class="pre">new</span> <span class="pre">X&lt;&gt;()</span></code></td>
<td><code class="docutils literal"><span class="pre">X::new</span></code></td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p>こんな書き方もあることを頭の片隅にでも入れておいてください（後で登場します）。</p>
</div>
</div>
<div class="section" id="id4">
<h3>ラムダ式と匿名クラスの違い<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id4" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ラムダ式は匿名クラスの「ほぼ」構文糖衣となっていますが、文法的にはthisの取り扱いに関する違いがあります。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last"><a class="reference external" href="http://www.atmarkit.co.jp/ait/articles/1403/17/news105_2.html">http://www.atmarkit.co.jp/ait/articles/1403/17/news105_2.html</a></p>
</div>
</div>
<div class="section" id="id5">
<h3>関数型インターフェイスの作り方<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>インターフェイスの抽象メソッドを１つだけ用意すれば自動的に関数型インターフェイスとなります。関数型インターフェイスであることを明示したい場合は、<a href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id6"><span class="problematic" id="id7">``</span></a>@FunctionalInterface``アノテーションを付与します。</p>
</div>
</div>
<div class="section" id="sqlstream-api">
<h2>SQLに学ぶStream APIとコレクション操作<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#sqlstream-api" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="stream">
<h3>Stream の概要<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#stream" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Stream は複数の値に対して行う処理を記述する新しい方法です。
List や Map、File の中身などを処理する場合に使えます。</p>
<p>Stream での処理の記述は「途中の処理」を並べて「まとめ処理」で終わるように書きます。「途中の処理」は「中間処理」と呼び、だいたいは、新しい Stream を返すメソッド群がそれにあたります。「まとめ処理」は「終端処理」と呼びます。</p>
<p>Stream の処理の実際は、中間処理メソッドが呼ばれた時ではなく、終端処理メソッドが呼ばれた時に行われます。
List を処理するループの書き換えで言えば、Stream への書き換えはループの中で何をやるのかを分解して記述する感じになります。</p>
<p>ループ内の処理を分解して記述することは、処理個々のテストを容易にする事に注目してください。ループの全テストは、ループ件数に起因するバグのおそれがある以上、テストケースが無限大になり、論理的には不可能です。従ってループ内の処理をメソッドに切り出し、それぞれの処理の単体テストを行うことがループ処理を堅牢にする手段になりえますが、テストされた Stream API を使った Stream 処理への書き換えは、メソッドに切り出すのが面倒な単純な処理についてそれに近いメリットを提供してくれます。</p>
</div>
<div class="section" id="id8">
<h3>解説<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id8" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Oracle DBに付属するサンプルデータ、EMPとDEPTを利用して説明します。対応するJavaソースコードとして以下のものを利用します。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.time.LocalDate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Emp</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">empno</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ename</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">job</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">Long</span> <span class="n">mgr</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">LocalDate</span> <span class="n">hiredate</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">sal</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">Long</span> <span class="n">comm</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">deptno</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Emp</span><span class="o">(</span><span class="kt">long</span> <span class="n">empno</span><span class="o">,</span> <span class="n">String</span> <span class="n">ename</span><span class="o">,</span> <span class="n">String</span> <span class="n">job</span><span class="o">,</span> <span class="n">Long</span> <span class="n">mgr</span><span class="o">,</span> <span class="n">LocalDate</span> <span class="n">hiredate</span><span class="o">,</span> <span class="kt">long</span> <span class="n">sal</span><span class="o">,</span> <span class="n">Long</span> <span class="n">comm</span><span class="o">,</span> <span class="kt">long</span> <span class="n">deptno</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">empno</span> <span class="o">=</span> <span class="n">empno</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">ename</span> <span class="o">=</span> <span class="n">ename</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">job</span> <span class="o">=</span> <span class="n">job</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">mgr</span> <span class="o">=</span> <span class="n">mgr</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">hiredate</span> <span class="o">=</span> <span class="n">hiredate</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">sal</span> <span class="o">=</span> <span class="n">sal</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">comm</span> <span class="o">=</span> <span class="n">comm</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">deptno</span> <span class="o">=</span> <span class="n">deptno</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getEmpno</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">empno</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getEname</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">ename</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getJob</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">job</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getMgr</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">mgr</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">LocalDate</span> <span class="nf">getHiredate</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">hiredate</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getSal</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">sal</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getComm</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">comm</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getDeptno</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">deptno</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="s">"Emp [empno="</span> <span class="o">+</span> <span class="n">empno</span> <span class="o">+</span> <span class="s">", ename="</span> <span class="o">+</span> <span class="n">ename</span> <span class="o">+</span> <span class="s">", job="</span> <span class="o">+</span> <span class="n">job</span> <span class="o">+</span> <span class="s">", mgr="</span> <span class="o">+</span> <span class="n">mgr</span> <span class="o">+</span> <span class="s">", hiredate="</span> <span class="o">+</span> <span class="n">hiredate</span> <span class="o">+</span> <span class="s">", sal="</span> <span class="o">+</span> <span class="n">sal</span> <span class="o">+</span> <span class="s">", comm="</span>
                                <span class="o">+</span> <span class="n">comm</span> <span class="o">+</span> <span class="s">", deptno="</span> <span class="o">+</span> <span class="n">deptno</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">SAMPLE_DATA</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7369L</span><span class="o">,</span> <span class="s">"SMITH"</span><span class="o">,</span>  <span class="s">"CLERK"</span><span class="o">,</span>     <span class="mi">7902L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1980</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">17</span><span class="o">),</span>  <span class="mi">800L</span><span class="o">,</span>  <span class="kc">null</span><span class="o">,</span> <span class="mi">20L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7499L</span><span class="o">,</span> <span class="s">"ALLEN"</span><span class="o">,</span>  <span class="s">"SALESMAN"</span><span class="o">,</span>  <span class="mi">7698L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1981</span><span class="o">,</span>  <span class="mi">2</span><span class="o">,</span> <span class="mi">20</span><span class="o">),</span> <span class="mi">1600L</span><span class="o">,</span>  <span class="mi">300L</span><span class="o">,</span> <span class="mi">30L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7521L</span><span class="o">,</span> <span class="s">"WARD"</span><span class="o">,</span>   <span class="s">"SALESMAN"</span><span class="o">,</span>  <span class="mi">7698L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1981</span><span class="o">,</span>  <span class="mi">2</span><span class="o">,</span> <span class="mi">22</span><span class="o">),</span> <span class="mi">1250L</span><span class="o">,</span>  <span class="mi">500L</span><span class="o">,</span> <span class="mi">30L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7566L</span><span class="o">,</span> <span class="s">"JONES"</span><span class="o">,</span>  <span class="s">"MANAGER"</span><span class="o">,</span>   <span class="mi">7839L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1981</span><span class="o">,</span>  <span class="mi">4</span><span class="o">,</span>  <span class="mi">2</span><span class="o">),</span> <span class="mi">2975L</span><span class="o">,</span>  <span class="kc">null</span><span class="o">,</span> <span class="mi">20L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7654L</span><span class="o">,</span> <span class="s">"MARTIN"</span><span class="o">,</span> <span class="s">"SALESMAN"</span><span class="o">,</span>  <span class="mi">7698L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1981</span><span class="o">,</span>  <span class="mi">9</span><span class="o">,</span> <span class="mi">28</span><span class="o">),</span> <span class="mi">1250L</span><span class="o">,</span> <span class="mi">1400L</span><span class="o">,</span> <span class="mi">30L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7698L</span><span class="o">,</span> <span class="s">"BLAKE"</span><span class="o">,</span>  <span class="s">"MANAGER"</span><span class="o">,</span>   <span class="mi">7839L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1981</span><span class="o">,</span>  <span class="mi">5</span><span class="o">,</span>  <span class="mi">1</span><span class="o">),</span> <span class="mi">2850L</span><span class="o">,</span>  <span class="kc">null</span><span class="o">,</span> <span class="mi">30L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7782L</span><span class="o">,</span> <span class="s">"CLARK"</span><span class="o">,</span>  <span class="s">"MANAGER"</span><span class="o">,</span>   <span class="mi">7839L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1981</span><span class="o">,</span>  <span class="mi">6</span><span class="o">,</span>  <span class="mi">9</span><span class="o">),</span> <span class="mi">2450L</span><span class="o">,</span>  <span class="kc">null</span><span class="o">,</span> <span class="mi">10L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7788L</span><span class="o">,</span> <span class="s">"SCOTT"</span><span class="o">,</span>  <span class="s">"ANALYST"</span><span class="o">,</span>   <span class="mi">7566L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1982</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span>  <span class="mi">9</span><span class="o">),</span> <span class="mi">3000L</span><span class="o">,</span>  <span class="kc">null</span><span class="o">,</span> <span class="mi">20L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7839L</span><span class="o">,</span> <span class="s">"KING"</span><span class="o">,</span>   <span class="s">"PRESIDENT"</span><span class="o">,</span>  <span class="kc">null</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1981</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">17</span><span class="o">),</span> <span class="mi">5000L</span><span class="o">,</span>  <span class="kc">null</span><span class="o">,</span> <span class="mi">10L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7844L</span><span class="o">,</span> <span class="s">"TURNER"</span><span class="o">,</span> <span class="s">"SALESMAN"</span><span class="o">,</span>  <span class="mi">7698L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1981</span><span class="o">,</span>  <span class="mi">9</span><span class="o">,</span>  <span class="mi">8</span><span class="o">),</span> <span class="mi">1500L</span><span class="o">,</span>    <span class="mi">0</span><span class="n">L</span><span class="o">,</span> <span class="mi">30L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7876L</span><span class="o">,</span> <span class="s">"ADAMS"</span><span class="o">,</span>  <span class="s">"CLERK"</span><span class="o">,</span>     <span class="mi">7788L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1983</span><span class="o">,</span>  <span class="mi">1</span><span class="o">,</span> <span class="mi">12</span><span class="o">),</span> <span class="mi">1100L</span><span class="o">,</span>  <span class="kc">null</span><span class="o">,</span> <span class="mi">20L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7900L</span><span class="o">,</span> <span class="s">"JAMES"</span><span class="o">,</span>  <span class="s">"CLERK"</span><span class="o">,</span>     <span class="mi">7698L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1981</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span>  <span class="mi">3</span><span class="o">),</span>  <span class="mi">950L</span><span class="o">,</span>  <span class="kc">null</span><span class="o">,</span> <span class="mi">30L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7902L</span><span class="o">,</span> <span class="s">"FORD"</span><span class="o">,</span>   <span class="s">"ANALYST"</span><span class="o">,</span>   <span class="mi">7566L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1981</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span>  <span class="mi">3</span><span class="o">),</span> <span class="mi">3000L</span><span class="o">,</span>  <span class="kc">null</span><span class="o">,</span> <span class="mi">20L</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="mi">7934L</span><span class="o">,</span> <span class="s">"MILLER"</span><span class="o">,</span> <span class="s">"CLERK"</span><span class="o">,</span>     <span class="mi">7782L</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1982</span><span class="o">,</span>  <span class="mi">1</span><span class="o">,</span> <span class="mi">23</span><span class="o">),</span> <span class="mi">1300L</span><span class="o">,</span>  <span class="kc">null</span><span class="o">,</span> <span class="mi">10L</span><span class="o">)</span>
        <span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Dept</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">deptno</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">dname</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">loc</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Dept</span><span class="o">(</span><span class="kt">long</span> <span class="n">deptno</span><span class="o">,</span> <span class="n">String</span> <span class="n">dname</span><span class="o">,</span> <span class="n">String</span> <span class="n">loc</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">deptno</span> <span class="o">=</span> <span class="n">deptno</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">dname</span> <span class="o">=</span> <span class="n">dname</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">loc</span> <span class="o">=</span> <span class="n">loc</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getDeptno</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">deptno</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDname</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">dname</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getLoc</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">loc</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="s">"Dept [deptno="</span> <span class="o">+</span> <span class="n">deptno</span> <span class="o">+</span> <span class="s">", dname="</span> <span class="o">+</span> <span class="n">dname</span> <span class="o">+</span> <span class="s">", loc="</span> <span class="o">+</span> <span class="n">loc</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Dept</span><span class="o">&gt;</span> <span class="n">SAMPLE_DATA</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">Dept</span><span class="o">(</span><span class="mi">10L</span><span class="o">,</span> <span class="s">"ACCOUNTING"</span><span class="o">,</span> <span class="s">"NEW YORK"</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Dept</span><span class="o">(</span><span class="mi">20L</span><span class="o">,</span> <span class="s">"RESEARCH"</span><span class="o">,</span>   <span class="s">"DALLAS"</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Dept</span><span class="o">(</span><span class="mi">30L</span><span class="o">,</span> <span class="s">"SALES"</span><span class="o">,</span>      <span class="s">"CHICAGO"</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Dept</span><span class="o">(</span><span class="mi">40L</span><span class="o">,</span> <span class="s">"OPERATIONS"</span><span class="o">,</span> <span class="s">"BOSTON"</span><span class="o">)</span>
        <span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>また、例題の動作確認のため、次のソースコードを利用しても構いません。</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock1&#39;))">+ show/hide code</a><br><div id="hiddencodeblock1" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// FROM EMP</span>
                                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()</span> <span class="o">==</span> <span class="mi">10</span><span class="o">)</span> <span class="c1">// WHERE DEPTNO = 10</span>
                                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
                <span class="n">PrintHelper</span><span class="o">.</span><span class="na">printEmployees</span><span class="o">(</span><span class="n">employees</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div><script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock2&#39;))">+ show/hide code</a><br><div id="hiddencodeblock2" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.function.Consumer</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PrintHelper</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">TARGET</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">;</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printEmployees</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">TARGET</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">"===== ====== ========= ==== ========== ==== ==== ======"</span><span class="o">);</span>
                <span class="n">TARGET</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">"EMPNO ENAME  JOB       MGR  HIREDATE   SAL  COMM DEPTNO"</span><span class="o">);</span>
                <span class="n">TARGET</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">"===== ====== ========= ==== ========== ==== ==== ======"</span><span class="o">);</span>
                <span class="n">employees</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">e</span> <span class="o">-&gt;</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%4d  %6s %9s %4s %5$tY-%5$tm-%td %4s %4s   %4s"</span><span class="o">,</span>
                                <span class="n">e</span><span class="o">.</span><span class="na">getEmpno</span><span class="o">(),</span> <span class="n">e</span><span class="o">.</span><span class="na">getEname</span><span class="o">(),</span> <span class="n">e</span><span class="o">.</span><span class="na">getJob</span><span class="o">(),</span> <span class="n">e</span><span class="o">.</span><span class="na">getMgr</span><span class="o">(),</span> <span class="n">e</span><span class="o">.</span><span class="na">getHiredate</span><span class="o">(),</span> <span class="n">e</span><span class="o">.</span><span class="na">getSal</span><span class="o">(),</span> <span class="n">e</span><span class="o">.</span><span class="na">getComm</span><span class="o">(),</span> <span class="n">e</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()</span>
                        <span class="o">))</span>
                        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">TARGET</span><span class="o">);</span>
                <span class="n">TARGET</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">"===== ====== ========= ==== ========== ==== ==== ======"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printEmpDeptPairs</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">,</span> <span class="n">Dept</span><span class="o">&gt;&gt;</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">TARGET</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">"===== ====== ========= ==== ========== ======= ==== ====== ========== ========"</span><span class="o">);</span>
                <span class="n">TARGET</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">"EMPNO ENAME  JOB       MGR  HIREDATE   SAL     COMM DEPTNO DNAME      LOC"</span><span class="o">);</span>
                <span class="n">TARGET</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">"===== ====== ========= ==== ========== ======= ==== ====== ========== ========"</span><span class="o">);</span>
                <span class="n">pairs</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%4d  %6s %9s %4s %s %4s %4s   %4s %10s %8s"</span><span class="o">,</span>
                                <span class="n">p</span><span class="o">.</span><span class="na">getA</span><span class="o">().</span><span class="na">getEmpno</span><span class="o">(),</span> <span class="n">p</span><span class="o">.</span><span class="na">getA</span><span class="o">().</span><span class="na">getEname</span><span class="o">(),</span> <span class="n">p</span><span class="o">.</span><span class="na">getA</span><span class="o">().</span><span class="na">getJob</span><span class="o">(),</span> <span class="n">p</span><span class="o">.</span><span class="na">getA</span><span class="o">().</span><span class="na">getMgr</span><span class="o">(),</span>
                                <span class="n">p</span><span class="o">.</span><span class="na">getA</span><span class="o">().</span><span class="na">getHiredate</span><span class="o">(),</span> <span class="n">p</span><span class="o">.</span><span class="na">getA</span><span class="o">().</span><span class="na">getSal</span><span class="o">(),</span> <span class="n">p</span><span class="o">.</span><span class="na">getA</span><span class="o">().</span><span class="na">getComm</span><span class="o">(),</span> <span class="n">p</span><span class="o">.</span><span class="na">getA</span><span class="o">().</span><span class="na">getDeptno</span><span class="o">(),</span>
                                <span class="n">p</span><span class="o">.</span><span class="na">getB</span><span class="o">().</span><span class="na">getDname</span><span class="o">(),</span> <span class="n">p</span><span class="o">.</span><span class="na">getB</span><span class="o">().</span><span class="na">getLoc</span><span class="o">()</span>
                        <span class="o">))</span>
                        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">TARGET</span><span class="o">);</span>
                <span class="n">TARGET</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">"===== ====== ========= ==== ========== ======= ==== ====== ========== ========"</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div><div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>Java 8に新たに追加された日付APIのLocalDateを利用しています。
Date型とは異なり、LocalDateインスタンスはタイムゾーンを保持しません。そのため、Date型との変換も可能ですが、その際にはタイムゾーンを意識しなければなりません（当たり前ですし、むしろ健全です）。</p>
<div class="last admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last"><a class="reference external" href="http://blog.progs.be/542/date-to-java-time">http://blog.progs.be/542/date-to-java-time</a></p>
</div>
</div>
</div>
<div class="section" id="template-of-convertion-of-list-to-list-listlist">
<h3>Template of convertion of List to List / List→Listのテンプレート<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#template-of-convertion-of-list-to-list-listlist" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>基本中の基本で、テンプレートとなります。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Dto</span><span class="o">&gt;</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Dto</span><span class="o">&gt;</span> <span class="n">destination</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="cm">/** ここに処理を記述する **/</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">source.stream()</span></code> リストからストリームを生成しています。</li>
<li><code class="docutils literal"><span class="pre">.collect(Collectors.toList());</span></code> ストリームを最後にどうするか設定します。リスト（表）形式にしたい場合は``Collectors.toList()``を設定します。これはちょうど、<a href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id9"><span class="problematic" id="id10">``</span></a>SELECT <a href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id11"><span class="problematic" id="id12">*</span></a><a href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id13"><span class="problematic" id="id14">``</span></a>に相当します。</li>
</ul>
</div>
<div class="section" id="where">
<h3>WHERE / 条件を絞る<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#where" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>SQLのWHERE句に相当する操作は、filter()メソッドになります。
filter()メソッドに渡されたラムダ式の評価結果がtrueの要素だけがフィルターされて残ります。</p>
<div class="section" id="sql-style">
<h4>SQL Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#sql-style" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%">
<col width="13%">
<col width="19%">
<col width="8%">
<col width="21%">
<col width="8%">
<col width="8%">
<col width="13%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
<th class="head">ENAME</th>
<th class="head">JOB</th>
<th class="head">MGR</th>
<th class="head">HIREDATE</th>
<th class="head">SAL</th>
<th class="head">COMM</th>
<th class="head">DEPTNO</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7782</td>
<td>CLARK</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-06-09</td>
<td>2450</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>7839</td>
<td>KING</td>
<td>PRESIDENT</td>
<td>null</td>
<td>1981-11-17</td>
<td>5000</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-even"><td>7934</td>
<td>MILLER</td>
<td>CLERK</td>
<td>7782</td>
<td>1982-01-23</td>
<td>1300</td>
<td>null</td>
<td>10</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="java-8-style">
<h4>Java 8 Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#java-8-style" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// FROM EMP</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()</span> <span class="o">==</span> <span class="mi">10</span><span class="o">)</span> <span class="c1">// WHERE DEPTNO = 10</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
</div>
<div class="section" id="old-java-style">
<h4>Old Java Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#old-java-style" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;();</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Emp</span> <span class="n">emp</span> <span class="o">:</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()</span> <span class="o">==</span> <span class="mi">10</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">employees</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">emp</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h4>例題 1<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id15" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>以下のSQL文に相当する要素を取得するためのJavaプログラムをStream APIを用いて作成してください。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">WHERE</span> <span class="n">JOB</span> <span class="o">=</span> <span class="s1">'MANAGER'</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%">
<col width="13%">
<col width="19%">
<col width="8%">
<col width="21%">
<col width="8%">
<col width="8%">
<col width="13%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
<th class="head">ENAME</th>
<th class="head">JOB</th>
<th class="head">MGR</th>
<th class="head">HIREDATE</th>
<th class="head">SAL</th>
<th class="head">COMM</th>
<th class="head">DEPTNO</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7566</td>
<td>JONES</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-04-02</td>
<td>2975</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7698</td>
<td>BLAKE</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-05-01</td>
<td>2850</td>
<td>null</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7782</td>
<td>CLARK</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-06-09</td>
<td>2450</td>
<td>null</td>
<td>10</td>
</tr>
</tbody>
</table>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">WHERE</span> <span class="n">SAL</span> <span class="k">BETWEEN</span> <span class="mi">1000</span> <span class="k">AND</span> <span class="mi">2000</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%">
<col width="13%">
<col width="19%">
<col width="8%">
<col width="21%">
<col width="8%">
<col width="8%">
<col width="13%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
<th class="head">ENAME</th>
<th class="head">JOB</th>
<th class="head">MGR</th>
<th class="head">HIREDATE</th>
<th class="head">SAL</th>
<th class="head">COMM</th>
<th class="head">DEPTNO</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7499</td>
<td>ALLEN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-20</td>
<td>1600</td>
<td>300</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>7521</td>
<td>WARD</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-22</td>
<td>1250</td>
<td>500</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7654</td>
<td>MARTIN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-09-28</td>
<td>1250</td>
<td>1400</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>7844</td>
<td>TURNER</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-09-08</td>
<td>1500</td>
<td>0</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7876</td>
<td>ADAMS</td>
<td>CLERK</td>
<td>7788</td>
<td>1983-01-12</td>
<td>1100</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7934</td>
<td>MILLER</td>
<td>CLERK</td>
<td>7782</td>
<td>1982-01-23</td>
<td>1300</td>
<td>null</td>
<td>10</td>
</tr>
</tbody>
</table>
<p><strong>【解答例】</strong></p>
<p><strong>(1)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock3&#39;))">+ show/hide code</a><br><div id="hiddencodeblock3" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getJob</span><span class="o">(),</span> <span class="s">"MANAGER"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
</div><p><strong>(2)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock4&#39;))">+ show/hide code</a><br><div id="hiddencodeblock4" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="mi">1000</span> <span class="o">&lt;=</span> <span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="mi">2000</span><span class="o">)</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="order-by">
<h3>ORDER BY / 要素を順に並べかえる<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#order-by" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>SQLのORDER BYに相当する操作は、sorted()メソッドになります。
sorted()メソッドの引数には、ソート順を決めるためのComparatorを渡します。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>Java 8ではComparatorの標準実装が用意されています。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">numbers</span><span class="o">);</span> <span class="c1">// [4, 15, 3, 0]</span>
<span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">numbers</span><span class="o">,</span> <span class="n">Comparator</span><span class="o">.</span><span class="na">reverseOrder</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">numbers</span><span class="o">);</span> <span class="c1">// [15, 4, 3, 0]</span>
</pre></div>
</div>
<p>自前ででComparatorを実装するのではなく、通常はこちらを利用してください。</p>
<ul class="last simple">
<li>Comparator.naturalOrder(): 自然順（昇順）</li>
<li>Comparator.reverseOrder(): 逆順（降順）</li>
<li>Comparator.nullsFirst(Comparator.naturalOrder()): nullが先頭に、残りは昇順</li>
<li>Comparator.comparingLong(x -&gt; x.getId()): xのID順</li>
<li>Comparator.comparingLong(x -&gt; -x.getId()); xのID逆順（ここだけ残念）</li>
</ul>
</div>
<div class="section" id="id16">
<h4>SQL Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id16" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">SAL</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%">
<col width="13%">
<col width="19%">
<col width="8%">
<col width="21%">
<col width="8%">
<col width="8%">
<col width="13%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
<th class="head">ENAME</th>
<th class="head">JOB</th>
<th class="head">MGR</th>
<th class="head">HIREDATE</th>
<th class="head">SAL</th>
<th class="head">COMM</th>
<th class="head">DEPTNO</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7369</td>
<td>SMITH</td>
<td>CLERK</td>
<td>7902</td>
<td>1980-12-17</td>
<td>800</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7900</td>
<td>JAMES</td>
<td>CLERK</td>
<td>7698</td>
<td>1981-12-03</td>
<td>950</td>
<td>null</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7876</td>
<td>ADAMS</td>
<td>CLERK</td>
<td>7788</td>
<td>1983-01-12</td>
<td>1100</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7521</td>
<td>WARD</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-22</td>
<td>1250</td>
<td>500</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7654</td>
<td>MARTIN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-09-28</td>
<td>1250</td>
<td>1400</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>7934</td>
<td>MILLER</td>
<td>CLERK</td>
<td>7782</td>
<td>1982-01-23</td>
<td>1300</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-even"><td>7844</td>
<td>TURNER</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-09-08</td>
<td>1500</td>
<td>0</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>7499</td>
<td>ALLEN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-20</td>
<td>1600</td>
<td>300</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7782</td>
<td>CLARK</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-06-09</td>
<td>2450</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>7698</td>
<td>BLAKE</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-05-01</td>
<td>2850</td>
<td>null</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7566</td>
<td>JONES</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-04-02</td>
<td>2975</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7788</td>
<td>SCOTT</td>
<td>ANALYST</td>
<td>7566</td>
<td>1982-12-09</td>
<td>3000</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-even"><td>7902</td>
<td>FORD</td>
<td>ANALYST</td>
<td>7566</td>
<td>1981-12-03</td>
<td>3000</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7839</td>
<td>KING</td>
<td>PRESIDENT</td>
<td>null</td>
<td>1981-11-17</td>
<td>5000</td>
<td>null</td>
<td>10</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id17">
<h4>Java 8 Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id17" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// FROM EMP</span>
        <span class="o">.</span><span class="na">sorted</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">comparingLong</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">()))</span> <span class="c1">// ORDER BY SAL; emp -&gt; emp.getSal()はEmp::getSalでも可</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>自前でComparatorを実装するには</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// FROM EMP</span>
        <span class="o">.</span><span class="na">sorted</span><span class="o">((</span><span class="n">emp1</span><span class="o">,</span> <span class="n">emp2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">emp1</span><span class="o">.</span><span class="na">getSal</span><span class="o">()).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">emp2</span><span class="o">.</span><span class="na">getSal</span><span class="o">()))</span> <span class="c1">// ORDER BY SAL</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id18">
<h4>例題 2<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id18" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>以下のSQL文に相当する要素を取得するためのJavaプログラムをStream APIを用いて作成してください。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">WHERE</span> <span class="n">JOB</span> <span class="o">=</span> <span class="s1">'MANAGER'</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">SAL</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%">
<col width="13%">
<col width="19%">
<col width="8%">
<col width="21%">
<col width="8%">
<col width="8%">
<col width="13%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
<th class="head">ENAME</th>
<th class="head">JOB</th>
<th class="head">MGR</th>
<th class="head">HIREDATE</th>
<th class="head">SAL</th>
<th class="head">COMM</th>
<th class="head">DEPTNO</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7782</td>
<td>CLARK</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-06-09</td>
<td>2450</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>7698</td>
<td>BLAKE</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-05-01</td>
<td>2850</td>
<td>null</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7566</td>
<td>JONES</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-04-02</td>
<td>2975</td>
<td>null</td>
<td>20</td>
</tr>
</tbody>
</table>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">DEPTNO</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">SAL</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%">
<col width="13%">
<col width="19%">
<col width="8%">
<col width="21%">
<col width="8%">
<col width="8%">
<col width="13%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
<th class="head">ENAME</th>
<th class="head">JOB</th>
<th class="head">MGR</th>
<th class="head">HIREDATE</th>
<th class="head">SAL</th>
<th class="head">COMM</th>
<th class="head">DEPTNO</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7900</td>
<td>JAMES</td>
<td>CLERK</td>
<td>7698</td>
<td>1981-12-03</td>
<td>950</td>
<td>null</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>7521</td>
<td>WARD</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-22</td>
<td>1250</td>
<td>500</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7654</td>
<td>MARTIN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-09-28</td>
<td>1250</td>
<td>1400</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>7844</td>
<td>TURNER</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-09-08</td>
<td>1500</td>
<td>0</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7499</td>
<td>ALLEN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-20</td>
<td>1600</td>
<td>300</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>7698</td>
<td>BLAKE</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-05-01</td>
<td>2850</td>
<td>null</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7369</td>
<td>SMITH</td>
<td>CLERK</td>
<td>7902</td>
<td>1980-12-17</td>
<td>800</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7876</td>
<td>ADAMS</td>
<td>CLERK</td>
<td>7788</td>
<td>1983-01-12</td>
<td>1100</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-even"><td>7566</td>
<td>JONES</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-04-02</td>
<td>2975</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7788</td>
<td>SCOTT</td>
<td>ANALYST</td>
<td>7566</td>
<td>1982-12-09</td>
<td>3000</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-even"><td>7902</td>
<td>FORD</td>
<td>ANALYST</td>
<td>7566</td>
<td>1981-12-03</td>
<td>3000</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7934</td>
<td>MILLER</td>
<td>CLERK</td>
<td>7782</td>
<td>1982-01-23</td>
<td>1300</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-even"><td>7782</td>
<td>CLARK</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-06-09</td>
<td>2450</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>7839</td>
<td>KING</td>
<td>PRESIDENT</td>
<td>null</td>
<td>1981-11-17</td>
<td>5000</td>
<td>null</td>
<td>10</td>
</tr>
</tbody>
</table>
<p><strong>【解答例】</strong></p>
<p><strong>(1)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock5&#39;))">+ show/hide code</a><br><div id="hiddencodeblock5" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getJob</span><span class="o">(),</span> <span class="s">"MANAGER"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">sorted</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">comparingDouble</span><span class="o">(</span><span class="n">Emp</span><span class="o">::</span><span class="n">getSal</span><span class="o">))</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
</div><p><strong>(2)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock6&#39;))">+ show/hide code</a><br><div id="hiddencodeblock6" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">sorted</span><span class="o">((</span><span class="n">emp1</span><span class="o">,</span> <span class="n">emp2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="c1">// first comparing by DEPTNO in descending order</span>
                <span class="kt">int</span> <span class="n">compByDeptno</span> <span class="o">=</span> <span class="o">-</span><span class="n">Comparator</span><span class="o">.</span><span class="na">comparingLong</span><span class="o">(</span><span class="n">Emp</span><span class="o">::</span><span class="n">getDeptno</span><span class="o">).</span><span class="na">compare</span><span class="o">(</span><span class="n">emp1</span><span class="o">,</span> <span class="n">emp2</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">compByDeptno</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="n">compByDeptno</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="c1">// when DEPTNOs equal each other, then comparing by SAL</span>
                <span class="k">return</span> <span class="n">Comparator</span><span class="o">.</span><span class="na">comparingLong</span><span class="o">(</span><span class="n">Emp</span><span class="o">::</span><span class="n">getSal</span><span class="o">).</span><span class="na">compare</span><span class="o">(</span><span class="n">emp1</span><span class="o">,</span> <span class="n">emp2</span><span class="o">);</span>
        <span class="o">})</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="select-column-dto">
<h3>SELECT column / DTOから別の値に<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#select-column-dto" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>DTOから一部の情報だけを抽出したい場合は、map()を使います。</p>
<div class="section" id="id19">
<h4>SQL Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id19" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">EMPNO</span> <span class="k">FROM</span> <span class="n">EMP</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="100%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7369</td>
</tr>
<tr class="row-odd"><td>7499</td>
</tr>
<tr class="row-even"><td>7521</td>
</tr>
<tr class="row-odd"><td>7566</td>
</tr>
<tr class="row-even"><td>7654</td>
</tr>
<tr class="row-odd"><td>7698</td>
</tr>
<tr class="row-even"><td>7782</td>
</tr>
<tr class="row-odd"><td>7788</td>
</tr>
<tr class="row-even"><td>7839</td>
</tr>
<tr class="row-odd"><td>7844</td>
</tr>
<tr class="row-even"><td>7876</td>
</tr>
<tr class="row-odd"><td>7900</td>
</tr>
<tr class="row-even"><td>7902</td>
</tr>
<tr class="row-odd"><td>7934</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id20">
<h4>Java 8 Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id20" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">employeeNos</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// FROM EMP</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getEmpno</span><span class="o">())</span> <span class="c1">// SELECT EMPNO; .map(Emp::getEmpno)も可</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
</div>
<div class="section" id="id21">
<h4>例題 3<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id21" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>以下のSQL文に相当する要素、もしくは文字列を取得するためのJavaプログラムをStream APIを用いて作成してください。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">SELECT</span> <span class="n">ENAME</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">WHERE</span> <span class="n">HIREDATE</span> <span class="o">&lt;</span> <span class="s1">'1981-01-01'</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="100%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">ENAME</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SMITH</td>
</tr>
</tbody>
</table>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">SELECT</span> <span class="n">EMPNO</span><span class="p">,</span> <span class="k">LOWER</span><span class="p">(</span><span class="n">ENAME</span><span class="p">)</span> <span class="k">AS</span> <span class="n">ENAME</span><span class="p">,</span> <span class="k">LOWER</span><span class="p">(</span><span class="n">JOB</span><span class="p">)</span> <span class="k">AS</span> <span class="n">JOB</span><span class="p">,</span> <span class="n">MGR</span><span class="p">,</span> <span class="n">HIREDATE</span><span class="p">,</span> <span class="n">SAL</span><span class="p">,</span> <span class="n">COMM</span><span class="p">,</span> <span class="n">DEPTNO</span> <span class="k">FROM</span> <span class="n">EMP</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%">
<col width="13%">
<col width="19%">
<col width="8%">
<col width="21%">
<col width="8%">
<col width="8%">
<col width="13%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
<th class="head">ENAME</th>
<th class="head">JOB</th>
<th class="head">MGR</th>
<th class="head">HIREDATE</th>
<th class="head">SAL</th>
<th class="head">COMM</th>
<th class="head">DEPTNO</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7369</td>
<td>smith</td>
<td>clerk</td>
<td>7902</td>
<td>1980-12-17</td>
<td>800</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7499</td>
<td>allen</td>
<td>salesman</td>
<td>7698</td>
<td>1981-02-20</td>
<td>1600</td>
<td>300</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7521</td>
<td>ward</td>
<td>salesman</td>
<td>7698</td>
<td>1981-02-22</td>
<td>1250</td>
<td>500</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>7566</td>
<td>jones</td>
<td>manager</td>
<td>7839</td>
<td>1981-04-02</td>
<td>2975</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-even"><td>7654</td>
<td>martin</td>
<td>salesman</td>
<td>7698</td>
<td>1981-09-28</td>
<td>1250</td>
<td>1400</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>7698</td>
<td>blake</td>
<td>manager</td>
<td>7839</td>
<td>1981-05-01</td>
<td>2850</td>
<td>null</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7782</td>
<td>clark</td>
<td>manager</td>
<td>7839</td>
<td>1981-06-09</td>
<td>2450</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>7788</td>
<td>scott</td>
<td>analyst</td>
<td>7566</td>
<td>1982-12-09</td>
<td>3000</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-even"><td>7839</td>
<td>king</td>
<td>president</td>
<td>null</td>
<td>1981-11-17</td>
<td>5000</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>7844</td>
<td>turner</td>
<td>salesman</td>
<td>7698</td>
<td>1981-09-08</td>
<td>1500</td>
<td>0</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7876</td>
<td>adams</td>
<td>clerk</td>
<td>7788</td>
<td>1983-01-12</td>
<td>1100</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7900</td>
<td>james</td>
<td>clerk</td>
<td>7698</td>
<td>1981-12-03</td>
<td>950</td>
<td>null</td>
<td>30</td>
</tr>
<tr class="row-even"><td>7902</td>
<td>ford</td>
<td>analyst</td>
<td>7566</td>
<td>1981-12-03</td>
<td>3000</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7934</td>
<td>miller</td>
<td>clerk</td>
<td>7782</td>
<td>1982-01-23</td>
<td>1300</td>
<td>null</td>
<td>10</td>
</tr>
</tbody>
</table>
<p><strong>【解答例】</strong></p>
<p><strong>(1)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock7&#39;))">+ show/hide code</a><br><div id="hiddencodeblock7" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getHiredate</span><span class="o">().</span><span class="na">isBefore</span><span class="o">(</span><span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1981</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">))</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">Emp</span><span class="o">::</span><span class="n">getEname</span><span class="o">)</span> <span class="c1">// .map(emp -&gt; emp.getEname() も可</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
</div><p><strong>(2)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock8&#39;))">+ show/hide code</a><br><div id="hiddencodeblock8" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Emp</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getEmpno</span><span class="o">(),</span> <span class="n">emp</span><span class="o">.</span><span class="na">getEname</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">(),</span> <span class="n">emp</span><span class="o">.</span><span class="na">getJob</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">(),</span>
                <span class="n">emp</span><span class="o">.</span><span class="na">getMgr</span><span class="o">(),</span> <span class="n">emp</span><span class="o">.</span><span class="na">getHiredate</span><span class="o">(),</span> <span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">(),</span> <span class="n">emp</span><span class="o">.</span><span class="na">getComm</span><span class="o">(),</span> <span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="id22">
<h3>集計関数<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id22" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Java 8には幾つかの集計関数が用意されています。集計値が欲しい場合、最後のcollect()メソッドを集計関数に置き換えることが出来ます。</p>
<div class="section" id="count">
<h4>COUNT(*)<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#count" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>Stream#count()関数を使うことが出来ます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">long</span> <span class="n">empCount</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// FROM EMP</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()</span> <span class="o">==</span> <span class="mi">10</span><span class="o">)</span> <span class="c1">// WHERE DEPTNO = 10</span>
        <span class="o">.</span><span class="na">count</span><span class="o">();</span> <span class="c1">// SELECT COUNT(*)</span>
</pre></div>
</div>
</div>
<div class="section" id="max-min">
<h4>MAX(*), MIN(*)<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#max-min" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>Stream#max()、Stream#min()関数を使うことが出来る。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">SAL</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">EMP</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">long</span> <span class="n">maxSalary</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// FROM EMP</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">())</span> <span class="c1">// (SAL); .map(Emp::getSal)も可</span>
        <span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">naturalOrder</span><span class="o">())</span> <span class="c1">// MAX</span>
        <span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="mi">0</span><span class="n">L</span><span class="o">);</span>
</pre></div>
</div>
<p>最後の.orElse(0)は、max()メソッドがOptional&lt;Long&gt;を返却することへの対応です。データ件数が0の場合、最大値は存在しないため、orElse()の引数でデフォルト値0を設定します。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">maxSalary</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// FROM EMP</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">())</span> <span class="c1">// (SAL); .map(Emp::getSal)も可</span>
        <span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">naturalOrder</span><span class="o">());</span> <span class="c1">// MAX</span>

<span class="k">if</span> <span class="o">(</span><span class="n">maxSalary</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"No employee"</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Max salary is $"</span> <span class="o">+</span> <span class="n">maxSalary</span><span class="o">()</span> <span class="o">+</span> <span class="s">" per month"</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>のようにOptional&lt;Long&gt;型を扱っても構いません。</p>
</div>
<div class="section" id="n">
<h4>初めのn件<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#n" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>給料が一番高い人を抽出する場合は次のようにします。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SQL</span> <span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">SAL</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%">
<col width="12%">
<col width="18%">
<col width="8%">
<col width="20%">
<col width="14%">
<col width="8%">
<col width="12%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
<th class="head">ENAME</th>
<th class="head">JOB</th>
<th class="head">MGR</th>
<th class="head">HIREDATE</th>
<th class="head">SAL</th>
<th class="head">COMM</th>
<th class="head">DEPTNO</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7839</td>
<td>KING</td>
<td>PRESIDENT</td>
<td>null</td>
<td>1981-11-17</td>
<td>5000</td>
<td>null</td>
<td>10</td>
</tr>
</tbody>
</table>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// FROM EMP</span>
        <span class="o">.</span><span class="na">sorted</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">comparingLong</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="o">-</span><span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">()))</span> <span class="c1">// ORDER BY SAL DESC</span>
        <span class="o">.</span><span class="na">findFirst</span><span class="o">();</span> <span class="c1">// SELECT * &amp; LIMIT 1</span>
</pre></div>
</div>
<p>データ件数が0の場合はOptional.empty()が返却されます。</p>
<p>高い方から最大n件抽出する場合は次のようにします。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">SAL</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">3</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%">
<col width="12%">
<col width="18%">
<col width="8%">
<col width="20%">
<col width="14%">
<col width="8%">
<col width="12%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
<th class="head">ENAME</th>
<th class="head">JOB</th>
<th class="head">MGR</th>
<th class="head">HIREDATE</th>
<th class="head">SAL</th>
<th class="head">COMM</th>
<th class="head">DEPTNO</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7839</td>
<td>KING</td>
<td>PRESIDENT</td>
<td>null</td>
<td>1981-12-17</td>
<td>5000</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>7788</td>
<td>SCOTT</td>
<td>ANALYST</td>
<td>7566</td>
<td>1983-01-09</td>
<td>3000</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-even"><td>7902</td>
<td>FORD</td>
<td>ANALYST</td>
<td>7566</td>
<td>1982-01-03</td>
<td>3000</td>
<td>null</td>
<td>20</td>
</tr>
</tbody>
</table>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// FROM EMP</span>
        <span class="o">.</span><span class="na">sorted</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">comparingLong</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="o">-</span><span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">()))</span> <span class="c1">// ORDER BY SAL DESC</span>
        <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
</div>
<div class="section" id="sum">
<h4>SUM(*)<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#sum" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>データ件数、最大、最小、平均値が必要な場合、Collectors.summarizingLong()を使うのが手っ取り早い方法です。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">LongSummaryStatistics</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">summarizingLong</span><span class="o">(</span><span class="n">Emp</span><span class="o">::</span><span class="n">getSal</span><span class="o">));</span>
<span class="kt">long</span> <span class="n">count</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span>
<span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="na">getSum</span><span class="o">();</span>
<span class="kt">long</span> <span class="n">max</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="na">getMax</span><span class="o">();</span>
<span class="kt">long</span> <span class="n">min</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="na">getMin</span><span class="o">();</span>
<span class="kt">double</span> <span class="n">average</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="na">getAverage</span><span class="o">();</span>
</pre></div>
</div>
<p>その他にも幾つかの方法があります。</p>
<p>数値専用のStreamに変換する方法もあります</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">long</span> <span class="n">sumOfSalary</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">mapToLong</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">())</span> <span class="c1">// .mapToLong(Emp::getSal)</span>
        <span class="o">.</span><span class="na">sum</span><span class="o">();</span>
</pre></div>
</div>
<p>一般的な集計にはreduce()を使うことが出来ます。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">long</span> <span class="n">sumOfSalary</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">())</span> <span class="c1">// .map(Emp::getSal)</span>
        <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="o">(</span><span class="n">sum</span><span class="o">,</span> <span class="n">sal</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">sum</span> <span class="o">+</span> <span class="n">sal</span><span class="o">);</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last"><a class="reference external" href="http://docs.oracle.com/javase/tutorial/collections/streams/reduction.html">http://docs.oracle.com/javase/tutorial/collections/streams/reduction.html</a></p>
</div>
</div>
<div class="section" id="id23">
<h4>例題 4<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id23" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>以下のSQL文に相当する数値を取得するためのJavaプログラムをStream APIを用いて作成してください。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">SAL</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="100%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">AVG(SAL)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2175.0</td>
</tr>
</tbody>
</table>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">SELECT</span> <span class="n">TOTAL</span><span class="p">(</span><span class="n">SAL</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">WHERE</span> <span class="n">JOB</span> <span class="o">=</span> <span class="s1">'MANAGER'</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="100%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">SUM(SAL)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>8275</td>
</tr>
</tbody>
</table>
<p><strong>【解答例】</strong></p>
<p><strong>(1)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock9&#39;))">+ show/hide code</a><br><div id="hiddencodeblock9" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">salaryAvarage</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()</span> <span class="o">==</span> <span class="mi">20</span><span class="o">)</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">summarizingLong</span><span class="o">(</span><span class="n">Emp</span><span class="o">::</span><span class="n">getSal</span><span class="o">))</span>
        <span class="o">.</span><span class="na">getAverage</span><span class="o">();</span>
</pre></div>
</div>
</div><p><strong>(2)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock10&#39;))">+ show/hide code</a><br><div id="hiddencodeblock10" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">long</span> <span class="n">sumOfSalary</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getJob</span><span class="o">(),</span> <span class="s">"MANAGER"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">mapToLong</span><span class="o">(</span><span class="n">Emp</span><span class="o">::</span><span class="n">getSal</span><span class="o">)</span>
        <span class="o">.</span><span class="na">sum</span><span class="o">();</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="map">
<h3>結果をMapで取得する<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#map" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Collectors.toList()の代わりにCollectors.toMap()を使うと、結果をMapで取得することができます。</p>
<div class="section" id="id24">
<h4>Java 8 Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id24" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employeeMap</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span>
                <span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getEmpno</span><span class="o">(),</span> <span class="c1">// key (Emp::getEmpnoも可)</span>
                <span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span>             <span class="c1">// value</span>
        <span class="o">));</span>
</pre></div>
</div>
</div>
<div class="section" id="id25">
<h4>Old Java Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id25" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employeeMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Emp</span><span class="o">&gt;();</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Emp</span> <span class="n">emp</span> <span class="o">:</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">employeeMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getEmpno</span><span class="o">(),</span> <span class="n">emp</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id26">
<h4>例題 5<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id26" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>以下の〈キー〉→〈値〉を引くためのMapを生成するJavaプログラムをStream APIを用いて作成してください。ただし、キーとなる値は一意であることを前提にして構いません。</p>
<ul class="simple">
<li><strong>(1)</strong> 〈社員名(Emp.getEname())〉→〈社員番号(Emp.getEmpno())〉</li>
<li><strong>(2)</strong> 〈社員名(Emp.getEname()〉→〈マネージャーの社員名(Emp.getMgr()→Emp.getEname())〉ただし、employeeMapは利用して構いません。生成されたマップに対してマネージャーがいない社員名でget()した際、nullが返却されるようにしてください。</li>
</ul>
<p><strong>【解答例】</strong></p>
<p><strong>(1)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock11&#39;))">+ show/hide code</a><br><div id="hiddencodeblock11" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">enameToEmpno</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span>
                <span class="n">Emp</span><span class="o">::</span><span class="n">getEname</span><span class="o">,</span>
                <span class="n">Emp</span><span class="o">::</span><span class="n">getEmpno</span>
        <span class="o">));</span>
</pre></div>
</div>
</div><p><strong>(2)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock12&#39;))">+ show/hide code</a><br><div id="hiddencodeblock12" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">managerMap</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="c1">// managerMap.get("KING") will result in null because no entry will registered by the employee "KING"</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getMgr</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="c1">// this filter is essential for avoiding NullPointerException.</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span>
                <span class="n">Emp</span><span class="o">::</span><span class="n">getEname</span><span class="o">,</span>
                <span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">employeeMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getMgr</span><span class="o">()).</span><span class="na">getEname</span><span class="o">()</span>
        <span class="o">));</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="group-by">
<h3>GROUP BY<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#group-by" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id27">
<h4>SQL Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id27" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">DEPTNO</span><span class="p">,</span> <span class="k">MIN</span><span class="p">(</span><span class="n">SAL</span><span class="p">),</span> <span class="k">MAX</span><span class="p">(</span><span class="n">SAL</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">DEPTNO</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="27%">
<col width="36%">
<col width="36%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">DEPTNO</th>
<th class="head">MIN(SAL)</th>
<th class="head">MAX(SAL)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>10</td>
<td>1300</td>
<td>5000</td>
</tr>
<tr class="row-odd"><td>20</td>
<td>800</td>
<td>3000</td>
</tr>
<tr class="row-even"><td>30</td>
<td>950</td>
<td>2850</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id28">
<h4>Java 8 Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id28" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>Collectors#groupingBy()が超強力です。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;&gt;</span> <span class="n">groupedByDeptNo</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()));</span> <span class="c1">// Emp::getDeptnoも可</span>
</pre></div>
</div>
<p>deptnoをキーに、List&lt;Emp&gt;がグループ化されます。</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>{20=[Emp [empno=7369, ename=SMITH, job=CLERK, mgr=7902, hiredate=1980-12-17, sal=800, comm=null, deptno=20],
     Emp [empno=7566, ename=JONES, job=MANAGER, mgr=7839, hiredate=1981-04-02, sal=2975, comm=null, deptno=20],
     Emp [empno=7788, ename=SCOTT, job=ANALYST, mgr=7566, hiredate=1982-12-09, sal=3000, comm=null, deptno=20],
     Emp [empno=7876, ename=ADAMS, job=CLERK, mgr=7788, hiredate=1983-01-12, sal=1100, comm=null, deptno=20],
     Emp [empno=7902, ename=FORD, job=ANALYST, mgr=7566, hiredate=1981-12-03, sal=3000, comm=null, deptno=20]
    ],
 10=[Emp [empno=7782, ename=CLARK, job=MANAGER, mgr=7839, hiredate=1981-06-09, sal=2450, comm=null, deptno=10],
     Emp [empno=7839, ename=KING, job=PRESIDENT, mgr=null, hiredate=1981-11-17, sal=5000, comm=null, deptno=10],
     Emp [empno=7934, ename=MILLER, job=CLERK, mgr=7782, hiredate=1982-01-23, sal=1300, comm=null, deptno=10]
    ],
 30=[Emp [empno=7499, ename=ALLEN, job=SALESMAN, mgr=7698, hiredate=1981-02-20, sal=1600, comm=300, deptno=30],
     Emp [empno=7521, ename=WARD, job=SALESMAN, mgr=7698, hiredate=1981-02-22, sal=1250, comm=500, deptno=30],
     Emp [empno=7654, ename=MARTIN, job=SALESMAN, mgr=7698, hiredate=1981-09-28, sal=1250, comm=1400, deptno=30],
     Emp [empno=7698, ename=BLAKE, job=MANAGER, mgr=7839, hiredate=1981-05-01, sal=2850, comm=null, deptno=30],
     Emp [empno=7844, ename=TURNER, job=SALESMAN, mgr=7698, hiredate=1981-09-08, sal=1500, comm=0, deptno=30],
     Emp [empno=7900, ename=JAMES, job=CLERK, mgr=7698, hiredate=1981-12-03, sal=950, comm=null, deptno=30]
    ]
}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">必要に応じて、集計を行ってください。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>一応、一気に集計結果を取得することも可能です。</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">LongSummaryStatistics</span><span class="o">&gt;</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span>
                <span class="n">Emp</span><span class="o">::</span><span class="n">getDeptno</span><span class="o">,</span>
                <span class="n">Collectors</span><span class="o">.</span><span class="na">summarizingLong</span><span class="o">(</span><span class="n">Emp</span><span class="o">::</span><span class="n">getSal</span><span class="o">))</span>
        <span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">summary</span><span class="o">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id29">
<h4>例題 6<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id29" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p><strong>(1)</strong> Emp.SAMPLE_DATAを「社員名の1文字目(Character型)」をキーにグループ化してください。</p>
<p><strong>(2)</strong> また、そのグループの中で、「1982年以降に入社した社員がいないグループ」だけを抽出したマップを新しく作成してください。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>「存在する」「存在しない」「すべてが」を判定するには、それぞれ、Stream#anyMatch()、Stream#noneMatch()、Stream#allMatch() を使います。</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">anyMatch</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()</span> <span class="o">==</span> <span class="mi">50</span><span class="o">)</span> <span class="c1">// → false</span>
<span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">noneMatch</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getJob</span><span class="o">(),</span> <span class="s">"ENGINEER"</span><span class="o">)</span> <span class="c1">// → true</span>
<span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">allMatch</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="mi">800</span><span class="o">)</span> <span class="c1">// → true</span>
</pre></div>
</div>
</div>
<p><strong>【解答例】</strong></p>
<p><strong>(1)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock13&#39;))">+ show/hide code</a><br><div id="hiddencodeblock13" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;&gt;</span> <span class="n">groupedByFirstLetter</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getEname</span><span class="o">().</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">)));</span>
</pre></div>
</div>
</div><p><strong>(2)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock14&#39;))">+ show/hide code</a><br><div id="hiddencodeblock14" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;&gt;</span> <span class="n">havingAllHiredBefore1982</span> <span class="o">=</span> <span class="n">groupedByFirstLetter</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">e</span> <span class="o">-&gt;</span>
                <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span><span class="cm">/*List&lt;Emp&gt;*/</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">noneMatch</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span>
                        <span class="o">!</span><span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1982</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">).</span><span class="na">isAfter</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getHiredate</span><span class="o">())</span>
                <span class="o">)</span>
        <span class="o">)</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">::</span><span class="n">getKey</span><span class="o">,</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">::</span><span class="n">getValue</span><span class="o">));</span>
</pre></div>
</div>
</div></div>
<div class="section" id="id30">
<h4>実例紹介<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id30" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>次のコードは、ある社内ツールにおいて実際にかかれているソースコードです（ソースコードのバージョンはJava 6）。
Java 8にすると、何をしたいコードなのかを明確に表現することが出来ます。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">DocCiConfirmingPermissionEntity</span><span class="o">&gt;&gt;</span>
                <span class="nf">groupByItemId</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">DocCiConfirmingPermissionEntity</span><span class="o">&gt;</span> <span class="n">entities</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">DocCiConfirmingPermissionEntity</span><span class="o">&gt;&gt;</span> <span class="n">result</span>
                        <span class="o">=</span> <span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">DocCiConfirmingPermissionEntity</span><span class="o">&gt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">DocCiConfirmingPermissionEntity</span> <span class="n">e</span> <span class="o">:</span> <span class="n">entities</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">long</span> <span class="n">itemId</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">docCiItemId</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(!</span><span class="n">result</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">itemId</span><span class="o">))</span> <span class="o">{</span>
                        <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">itemId</span><span class="o">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">DocCiConfirmingPermissionEntity</span><span class="o">&gt;());</span>
                <span class="o">}</span>
                <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">itemId</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>これは、</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">DocCiConfirmingPermissionEntity</span><span class="o">&gt;&gt;</span>
                <span class="nf">groupByItemId</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">DocCiConfirmingPermissionEntity</span><span class="o">&gt;</span> <span class="n">entities</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entities</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span>
                        <span class="n">e</span> <span class="o">-&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">docCiItemId</span><span class="o">,</span>
                        <span class="n">TreeMap</span><span class="o">::</span><span class="k">new</span><span class="o">,</span> <span class="c1">// creates a TreeMap instance</span>
                        <span class="n">Collectors</span><span class="o">.</span><span class="na">toCollection</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">::</span><span class="k">new</span><span class="o">)</span> <span class="c1">// grouped value ArrayList will be treated as Collection</span>
                <span class="o">));</span>
<span class="o">}</span>
</pre></div>
</div>
<p>とすることが出来ます。
Collectors.groupingBy()では、第2引数には戻り値として使うマップに（デフォルトのHashMapではなく）TreeMapを、第3引数にはそれぞれのグループをArrayListインスタンスをCollection型として取り扱うことを、それぞれ指定しています。</p>
<p>これは、戻り値の型が通常のgroupingBy()のMap&lt;Long, List&lt;DTO&gt;&gt;ではなく、
TreeMap&lt;Long, Collection&lt;DTO&gt;&gt;にするための措置となります。第2引数、第3引数を上手く利用することで、型や実装にある程度融通を利かせることができます。</p>
<p>メソッド型を変更しても構わない（特に、TreeMapではく、HashMapでも構わない）のならば、難しく考えずに</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">DocCiConfirmingPermissionEntity</span><span class="o">&gt;&gt;</span>
                <span class="nf">groupByItemId</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">DocCiConfirmingPermissionEntity</span><span class="o">&gt;</span> <span class="n">entities</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entities</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span><span class="n">e</span> <span class="o">-&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">docCiItemId</span><span class="o">));</span>
<span class="o">}</span>
</pre></div>
</div>
<p>としてもよいでしょう。</p>
</div>
</div>
<div class="section" id="inner-join-with-unique-key">
<h3>INNER JOIN (with unique key)<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#inner-join-with-unique-key" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>一意キーを使ってのテーブルの内部結合相当は、一意キーが設定されている側をMapに変換することで、速度劣化を防ぎながら実施することが出来ます。</p>
<div class="section" id="id31">
<h4>SQL Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id31" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span>
  <span class="mi">2</span>  <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">DEPT</span>
  <span class="mi">3</span>    <span class="k">ON</span> <span class="n">EMP</span><span class="p">.</span><span class="n">DEPTNO</span> <span class="o">=</span> <span class="n">DEPT</span><span class="p">.</span><span class="n">DEPTNO</span>
  <span class="mi">4</span>  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">EMP</span><span class="p">.</span><span class="n">DEPTNO</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="7%">
<col width="9%">
<col width="13%">
<col width="6%">
<col width="14%">
<col width="10%">
<col width="6%">
<col width="9%">
<col width="14%">
<col width="12%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
<th class="head">ENAME</th>
<th class="head">JOB</th>
<th class="head">MGR</th>
<th class="head">HIREDATE</th>
<th class="head">SAL</th>
<th class="head">COMM</th>
<th class="head">DEPTNO</th>
<th class="head">DNAME</th>
<th class="head">LOC</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7782</td>
<td>CLARK</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-07-09</td>
<td>2450</td>
<td>null</td>
<td>10</td>
<td>ACCOUNTING</td>
<td>NEW YORK</td>
</tr>
<tr class="row-odd"><td>7839</td>
<td>KING</td>
<td>PRESIDENT</td>
<td>null</td>
<td>1981-12-17</td>
<td>5000</td>
<td>null</td>
<td>10</td>
<td>ACCOUNTING</td>
<td>NEW YORK</td>
</tr>
<tr class="row-even"><td>7934</td>
<td>MILLER</td>
<td>CLERK</td>
<td>7782</td>
<td>1982-02-23</td>
<td>1300</td>
<td>null</td>
<td>10</td>
<td>ACCOUNTING</td>
<td>NEW YORK</td>
</tr>
<tr class="row-odd"><td>7369</td>
<td>SMITH</td>
<td>CLERK</td>
<td>7902</td>
<td>1981-01-17</td>
<td>800</td>
<td>null</td>
<td>20</td>
<td>RESEARCH</td>
<td>DALLAS</td>
</tr>
<tr class="row-even"><td>7566</td>
<td>JONES</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-05-02</td>
<td>2975</td>
<td>null</td>
<td>20</td>
<td>RESEARCH</td>
<td>DALLAS</td>
</tr>
<tr class="row-odd"><td>7788</td>
<td>SCOTT</td>
<td>ANALYST</td>
<td>7566</td>
<td>1983-01-09</td>
<td>3000</td>
<td>null</td>
<td>20</td>
<td>RESEARCH</td>
<td>DALLAS</td>
</tr>
<tr class="row-even"><td>7876</td>
<td>ADAMS</td>
<td>CLERK</td>
<td>7788</td>
<td>1983-02-12</td>
<td>1100</td>
<td>null</td>
<td>20</td>
<td>RESEARCH</td>
<td>DALLAS</td>
</tr>
<tr class="row-odd"><td>7902</td>
<td>FORD</td>
<td>ANALYST</td>
<td>7566</td>
<td>1982-01-03</td>
<td>3000</td>
<td>null</td>
<td>20</td>
<td>RESEARCH</td>
<td>DALLAS</td>
</tr>
<tr class="row-even"><td>7499</td>
<td>ALLEN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-03-20</td>
<td>1600</td>
<td>300</td>
<td>30</td>
<td>SALES</td>
<td>CHICAGO</td>
</tr>
<tr class="row-odd"><td>7521</td>
<td>WARD</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-03-22</td>
<td>1250</td>
<td>500</td>
<td>30</td>
<td>SALES</td>
<td>CHICAGO</td>
</tr>
<tr class="row-even"><td>7654</td>
<td>MARTIN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-10-28</td>
<td>1250</td>
<td>1400</td>
<td>30</td>
<td>SALES</td>
<td>CHICAGO</td>
</tr>
<tr class="row-odd"><td>7698</td>
<td>BLAKE</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-06-01</td>
<td>2850</td>
<td>null</td>
<td>30</td>
<td>SALES</td>
<td>CHICAGO</td>
</tr>
<tr class="row-even"><td>7844</td>
<td>TURNER</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-10-08</td>
<td>1500</td>
<td>0</td>
<td>30</td>
<td>SALES</td>
<td>CHICAGO</td>
</tr>
<tr class="row-odd"><td>7900</td>
<td>JAMES</td>
<td>CLERK</td>
<td>7698</td>
<td>1982-01-03</td>
<td>950</td>
<td>null</td>
<td>30</td>
<td>SALES</td>
<td>CHICAGO</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id32">
<h4>Java 8 Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id32" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Dept</span><span class="o">&gt;</span> <span class="n">deptMap</span> <span class="o">=</span> <span class="n">Dept</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">dept</span> <span class="o">-&gt;</span> <span class="n">dept</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">(),</span> <span class="n">dept</span> <span class="o">-&gt;</span> <span class="n">dept</span><span class="o">));</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">,</span> <span class="n">Dept</span><span class="o">&gt;&gt;</span> <span class="n">empDeptPairs</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">sorted</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">comparingLong</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Pair</span><span class="o">&lt;&gt;(</span><span class="n">emp</span><span class="o">,</span> <span class="n">deptMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">())))</span> <span class="c1">// deptMap is accessible lexically (closure)</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span> <span class="n">B</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">A</span> <span class="n">a</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">B</span> <span class="n">b</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">Pair</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">A</span> <span class="nf">getA</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">a</span><span class="o">;</span> <span class="o">}</span>
        <span class="kd">public</span> <span class="n">B</span> <span class="nf">getB</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">b</span><span class="o">;</span> <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="s">")"</span><span class="o">;</span> <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id33">
<h4>例題 7<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id33" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>以下のSQL文に相当する数値を取得するためのJavaプログラムをStream APIを用いて作成してください。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">E</span><span class="p">.</span><span class="n">EMPNO</span><span class="p">,</span> <span class="n">E</span><span class="p">.</span><span class="n">ENAME</span><span class="p">,</span> <span class="n">E</span><span class="p">.</span><span class="n">JOB</span><span class="p">,</span> <span class="n">E</span><span class="p">.</span><span class="n">MGR</span><span class="p">,</span> <span class="n">E</span><span class="p">.</span><span class="n">HIREDATE</span><span class="p">,</span> <span class="n">E</span><span class="p">.</span><span class="n">SAL</span><span class="p">,</span> <span class="n">E</span><span class="p">.</span><span class="n">COMM</span><span class="p">,</span> <span class="n">E</span><span class="p">.</span><span class="n">DEPTNO</span> <span class="c1">-- ようするにselect Emp</span>
  <span class="mi">2</span>   <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">AS</span> <span class="n">E</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">DEPT</span> <span class="k">AS</span> <span class="n">D</span>
  <span class="mi">3</span>     <span class="k">ON</span> <span class="n">E</span><span class="p">.</span><span class="n">DEPTNO</span> <span class="o">=</span> <span class="n">D</span><span class="p">.</span><span class="n">DEPTNO</span>
  <span class="mi">4</span>  <span class="k">WHERE</span> <span class="n">D</span><span class="p">.</span><span class="n">LOC</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'NEW YORK'</span><span class="p">,</span> <span class="s1">'DALLAS'</span><span class="p">)</span>
  <span class="mi">5</span>  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">E</span><span class="p">.</span><span class="n">DEPTNO</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%">
<col width="13%">
<col width="19%">
<col width="8%">
<col width="21%">
<col width="8%">
<col width="8%">
<col width="13%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
<th class="head">ENAME</th>
<th class="head">JOB</th>
<th class="head">MGR</th>
<th class="head">HIREDATE</th>
<th class="head">SAL</th>
<th class="head">COMM</th>
<th class="head">DEPTNO</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7782</td>
<td>CLARK</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-06-09</td>
<td>2450</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>7839</td>
<td>KING</td>
<td>PRESIDENT</td>
<td>null</td>
<td>1981-11-17</td>
<td>5000</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-even"><td>7934</td>
<td>MILLER</td>
<td>CLERK</td>
<td>7782</td>
<td>1982-01-23</td>
<td>1300</td>
<td>null</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>7369</td>
<td>SMITH</td>
<td>CLERK</td>
<td>7902</td>
<td>1980-12-17</td>
<td>800</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-even"><td>7566</td>
<td>JONES</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-04-02</td>
<td>2975</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7788</td>
<td>SCOTT</td>
<td>ANALYST</td>
<td>7566</td>
<td>1982-12-09</td>
<td>3000</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-even"><td>7876</td>
<td>ADAMS</td>
<td>CLERK</td>
<td>7788</td>
<td>1983-01-12</td>
<td>1100</td>
<td>null</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>7902</td>
<td>FORD</td>
<td>ANALYST</td>
<td>7566</td>
<td>1981-12-03</td>
<td>3000</td>
<td>null</td>
<td>20</td>
</tr>
</tbody>
</table>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">DEPT</span><span class="p">.</span><span class="n">LOC</span>
  <span class="mi">2</span>   <span class="k">FROM</span> <span class="n">DEPT</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">EMP</span>
  <span class="mi">3</span>     <span class="k">ON</span> <span class="n">DEPT</span><span class="p">.</span><span class="n">DEPTNO</span> <span class="o">=</span> <span class="n">EMP</span><span class="p">.</span><span class="n">DEPTNO</span>
  <span class="mi">4</span>  <span class="k">WHERE</span> <span class="n">SAL</span> <span class="o">&lt;</span> <span class="mi">1200</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="100%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">LOC</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CHICAGO</td>
</tr>
<tr class="row-odd"><td>DALLAS</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">“DISTINCT”はちょっとしたアイディアで実現できます</p>
</div>
<p><strong>【解答例】</strong></p>
<p><strong>(1)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock15&#39;))">+ show/hide code</a><br><div id="hiddencodeblock15" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">targetLocations</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"NEW YORK"</span><span class="o">,</span> <span class="s">"DALLAS"</span><span class="o">));</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Dept</span><span class="o">&gt;</span> <span class="n">deptMap</span> <span class="o">=</span> <span class="n">Dept</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">dept</span> <span class="o">-&gt;</span> <span class="n">dept</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">(),</span> <span class="n">dept</span> <span class="o">-&gt;</span> <span class="n">dept</span><span class="o">));</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// Stream of Emp</span>
        <span class="o">.</span><span class="na">sorted</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">comparingLong</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Pair</span><span class="o">&lt;&gt;(</span><span class="n">emp</span><span class="o">,</span> <span class="n">deptMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">())))</span> <span class="c1">// Stream of Pair&lt;Emp, Dept&gt;</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">pair</span> <span class="o">-&gt;</span> <span class="n">targetLocations</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">pair</span><span class="o">.</span><span class="na">getB</span><span class="o">().</span><span class="na">getDname</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">pair</span> <span class="o">-&gt;</span> <span class="n">pair</span><span class="o">.</span><span class="na">getA</span><span class="o">())</span> <span class="c1">// Stream of Emp</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
</div><p>別解</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock16&#39;))">+ show/hide code</a><br><div id="hiddencodeblock16" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">targetLocations</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"NEW YORK"</span><span class="o">,</span> <span class="s">"DALLAS"</span><span class="o">));</span>
<span class="n">Set</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">targetDeptnos</span> <span class="o">=</span> <span class="n">Dept</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">dept</span> <span class="o">-&gt;</span> <span class="n">targetLocations</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">dept</span><span class="o">.</span><span class="na">getLoc</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">Dept</span><span class="o">::</span><span class="n">getDeptno</span><span class="o">)</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toSet</span><span class="o">());</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">targetDeptnos</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()))</span> <span class="c1">// you don't have to make new Pair instances</span>
        <span class="o">.</span><span class="na">sorted</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">comparingLong</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
</div><p><strong>(2)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock17&#39;))">+ show/hide code</a><br><div id="hiddencodeblock17" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Dept</span><span class="o">&gt;</span> <span class="n">deptMap</span> <span class="o">=</span> <span class="n">Dept</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">dept</span> <span class="o">-&gt;</span> <span class="n">dept</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">(),</span> <span class="n">dept</span> <span class="o">-&gt;</span> <span class="n">dept</span><span class="o">));</span>
<span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">locations</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// Stream of Emp</span>
        <span class="o">.</span><span class="na">sorted</span><span class="o">(</span><span class="n">Comparator</span><span class="o">.</span><span class="na">comparingLong</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Pair</span><span class="o">&lt;&gt;(</span><span class="n">emp</span><span class="o">,</span> <span class="n">deptMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">())))</span> <span class="c1">// Stream of Pair&lt;Emp, Dept&gt;</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">pair</span> <span class="o">-&gt;</span> <span class="n">pair</span><span class="o">.</span><span class="na">getA</span><span class="o">().</span><span class="na">getSal</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">1200</span><span class="o">)</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">pair</span> <span class="o">-&gt;</span> <span class="n">pair</span><span class="o">.</span><span class="na">getB</span><span class="o">().</span><span class="na">getLoc</span><span class="o">())</span> <span class="c1">// Stream of String(Dept.loc)</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toSet</span><span class="o">());</span> <span class="c1">// DISTINCT</span>
</pre></div>
</div>
</div><div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>このように、多重ループで処理されているプログラムは、主となるリスト以外をMapにするとスマートに書き下すことができます。</p>
<p class="last">ただし、ループの中でデータを読み捨てにしている（元が全件取得済みのリストではない）ものは大量件数を扱うおそれがあったり、実際にお客様先で大量件数を扱ってエラーになったりしたなどの理由でそういうアルゴリズム（マージ・ジョイン）を選択している可能性があるため、安易に書き直してはいけません。
JPAなどのO/Rマッパーを使っている場合、ただのリストを操作しているように見せつつ、実際には読み捨てになっている（Iteratorの裏側でフェッチが読み進むようになっている）場合があるので、DB操作周りでは特に注意が必要です。</p>
</div>
</div>
</div>
<div class="section" id="cross-join">
<h3>CROSS JOIN<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#cross-join" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>一意キーがない場合の結合は、一旦Stream&lt;Stream&lt;JoinedDTO&gt;&gt; （List&lt;List&lt;JoinedDTO&gt;&gt;）を作成し、
flatMap()でStream&lt;JoinedDTO&gt; （List&lt;JoinedDTO&gt;）とすることができます。</p>
<p>当たり前ですが、速度的には当然不利になりますので、採用は慎重に。</p>
<div class="section" id="id34">
<h4>SQL Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id34" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span>
  <span class="mi">2</span>  <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">CROSS</span> <span class="k">JOIN</span> <span class="n">DEPT</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="7%">
<col width="9%">
<col width="13%">
<col width="6%">
<col width="14%">
<col width="10%">
<col width="6%">
<col width="9%">
<col width="14%">
<col width="12%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EMPNO</th>
<th class="head">ENAME</th>
<th class="head">JOB</th>
<th class="head">MGR</th>
<th class="head">HIREDATE</th>
<th class="head">SAL</th>
<th class="head">COMM</th>
<th class="head">DEPTNO</th>
<th class="head">DNAME</th>
<th class="head">LOC</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7369</td>
<td>SMITH</td>
<td>CLERK</td>
<td>7902</td>
<td>1981-01-17</td>
<td>800</td>
<td>null</td>
<td>20</td>
<td>ACCOUNTING</td>
<td>NEW YORK</td>
</tr>
<tr class="row-odd"><td>7369</td>
<td>SMITH</td>
<td>CLERK</td>
<td>7902</td>
<td>1981-01-17</td>
<td>800</td>
<td>null</td>
<td>20</td>
<td>RESEARCH</td>
<td>DALLAS</td>
</tr>
<tr class="row-even"><td>7369</td>
<td>SMITH</td>
<td>CLERK</td>
<td>7902</td>
<td>1981-01-17</td>
<td>800</td>
<td>null</td>
<td>20</td>
<td>SALES</td>
<td>CHICAGO</td>
</tr>
<tr class="row-odd"><td>7369</td>
<td>SMITH</td>
<td>CLERK</td>
<td>7902</td>
<td>1981-01-17</td>
<td>800</td>
<td>null</td>
<td>20</td>
<td>OPERATIONS</td>
<td>BOSTON</td>
</tr>
<tr class="row-even"><td>7499</td>
<td>ALLEN</td>
<td>SALESMAN</td>
<td>7698</td>
<td><dl class="first last docutils">
<dt>1981-03-20</dt>
<dd>(OMIT)</dd>
</dl>
</td>
<td>1600</td>
<td>300</td>
<td>30</td>
<td>ACCOUNTING</td>
<td>NEW YORK</td>
</tr>
<tr class="row-odd"><td>7934</td>
<td>MILLER</td>
<td>CLERK</td>
<td>7782</td>
<td>1982-02-23</td>
<td>1300</td>
<td>null</td>
<td>10</td>
<td>SALES</td>
<td>CHICAGO</td>
</tr>
<tr class="row-even"><td>7934</td>
<td>MILLER</td>
<td>CLERK</td>
<td>7782</td>
<td>1982-02-23</td>
<td>1300</td>
<td>null</td>
<td>10</td>
<td>OPERATIONS</td>
<td>BOSTON</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id35">
<h4>Java 8 Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id35" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>FlatMapは二（多）重のストリーム（リスト）を一重のストリームに変換します。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">,</span> <span class="n">Dept</span><span class="o">&gt;&gt;</span> <span class="n">empDeptPairs</span> <span class="o">=</span> <span class="n">Emp</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">emp</span> <span class="o">-&gt;</span> <span class="n">Dept</span><span class="o">.</span><span class="na">SAMPLE_DATA</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// for each employee instance,</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">dept</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Emp</span><span class="o">,</span> <span class="n">Dept</span><span class="o">&gt;(</span><span class="n">emp</span><span class="o">,</span> <span class="n">dept</span><span class="o">))</span> <span class="c1">// for each dept instance, making a pair (of Emp-Dept).</span>
        <span class="o">)</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
<hr class="docutils">
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p>いくらJava側でSQL相当のことが出来るからといって、
DB側でSQL文を書かなくてよいことにはなりません。下手にJava側でフィルターしようとした結果、大量のデータ転送が発生し、非常に遅いプログラムができかねません。</p>
<p class="last">DBサーバー側でデータ転送を制限するためのSQL文は、これまで同様に入念に設計する必要があります。</p>
</div>
</div>
</div>
</div>
<hr class="docutils">
<div class="section" id="forstream-api">
<h2>for文をStream APIに書き換える<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#forstream-api" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Stream APIを用いると、「反復処理の制御を行う」という責任と、「個々の要素に対する制御を行う」という責任とを分割することができます。</p>
<div class="section" id="id36">
<h3>コレクションの内容を一行ずつ表示する<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id36" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>コレクションの内容を一行ずつ画面に表示したい場合、Iterable#forEachもしくはStream#forEachを利用します。</p>
<div class="section" id="old-style">
<h4>Old Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#old-style" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">:</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="new-style">
<h4>New Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#new-style" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">).</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// .stream()は無くてもOK</span>
        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</pre></div>
</div>
<p>データを加工して表示したい場合は、Stream#map()を使うと便利です。</p>
</div>
<div class="section" id="id37">
<h4>Old Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id37" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">:</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"x = "</span> <span class="o">+</span> <span class="n">x</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id38">
<h4>New Style<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id38" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">).</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="s">"x = "</span> <span class="o">+</span> <span class="n">x</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</pre></div>
</div>
<p>または、</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">).</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// .stream()は無くてもOK</span>
        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"x = "</span> <span class="o">+</span> <span class="n">x</span><span class="o">));</span>
</pre></div>
</div>
<p>Stream や IntStream クラスは Stream を生成することができます。
builder も持っているので、builder に要素を add してから build でも構いませんが、</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">IntStream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"x = "</span> <span class="o">+</span> <span class="n">x</span><span class="o">));</span>
</pre></div>
</div>
<p>のように、初期値を渡して簡単に生成することができます。
IntStream の range メソッドを使えば</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">IntStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"x = "</span> <span class="o">+</span> <span class="n">x</span><span class="o">));</span>
</pre></div>
</div>
<p>のように カウンタを使った for ループのようなものも簡単に stream にできます。（range は第二引数の値を含みません。含めたい場合には rangeClosed メソッドを使います）</p>
</div>
</div>
<div class="section" id="iterator-iterable-stream">
<h3>Iterator / Iterable から Stream を生成する<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#iterator-iterable-stream" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>List からの Stream の生成方法は分かりましたか？では、取得できるものが Iterator / Iterable の場合にはどうしたらよいのでしょうか？</p>
<p>Iterable からは簡単に stream を生成できます。任意の Iterable itb からは</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">StreamSupport</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">itb</span><span class="o">.</span><span class="na">spliterator</span><span class="o">(),</span> <span class="kc">false</span><span class="o">);</span>
</pre></div>
</div>
<p>とすることで Stream を作ることができます。（第二引数の false は parallelStream に対応していないことを表しています）</p>
<p>Iterator it から生成するには Iterable のこの性質を利用し、いったん Iterable を作ってあげるのが簡単でしょう。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">itb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">it</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">};</span>
<span class="n">StreamSupport</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">itb</span><span class="o">.</span><span class="na">spliterator</span><span class="o">(),</span> <span class="kc">false</span><span class="o">);</span>
</pre></div>
</div>
<p>ところで、Iterable はメソッドがひとつだけのインタフェースです。何かを思い出しませんか？　……そうです、ラムダです。</p>
<p>このプログラムは以下のように短縮することができます。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">itb</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">it</span><span class="o">;</span>
<span class="n">StreamSupport</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">itb</span><span class="o">.</span><span class="na">spliterator</span><span class="o">(),</span> <span class="kc">false</span><span class="o">);</span>
</pre></div>
</div>
<p>Iterable / Iterator からの Stream の作り方は以上ですが、Iterator については java8 から Consumer を受け取るパターンもあるのでそちらも紹介します。簡単な処理の場合、こちらで書いたほうがよいかもしれません。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">action1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">String</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// t is each value of it</span>
                <span class="o">}</span>
        <span class="o">};</span>
<span class="n">it</span><span class="o">.</span><span class="na">forEachRemaining</span><span class="o">(</span><span class="n">action1</span><span class="o">);</span>
</pre></div>
</div>
<p>Consumer も accept だけを実装すればよいインタフェースなのでラムダにできますが、Consumer の場合、andThen で処理を続けていくことができるので、無名内部クラスを活用した方がよいかもしれません。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">action1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">String</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// t is each value of it</span>
                <span class="o">}</span>
        <span class="o">};</span>
<span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">action2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">String</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// t is each value of it</span>
                <span class="o">}</span>
        <span class="o">};</span>
<span class="n">it</span><span class="o">.</span><span class="na">forEachRemaining</span><span class="o">(</span><span class="n">action1</span><span class="o">.</span><span class="na">andThen</span><span class="o">(</span><span class="n">action2</span><span class="o">));</span>
</pre></div>
</div>
<p>なお、ラムダでもできないわけではありません。ちょっと括弧が多くなるだけです……</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">it</span><span class="o">.</span><span class="na">forEachRemaining</span><span class="o">(</span>
                <span class="o">((</span><span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span> <span class="o">(</span><span class="n">e</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">)))</span>
                <span class="o">.</span><span class="na">andThen</span><span class="o">(</span><span class="n">e</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">)));</span>
</pre></div>
</div>
</div>
<div class="section" id="id39">
<h3>ファイルの中身を1行ずつ表示する<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id39" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Files.readAllLines()は便利に使うことが出来ますが、メモリ消費量について注意を払う必要があります。もし巨大なテキストファイルをFiles.readAllLines()で読み込む場合、OoMが発生する可能性もあります。加えて、全ての行がメモリ上に読み込まれるまで続く処理を行うことが出来ないので、
HUE的には速度劣化の原因にもなるかもしれません。</p>
<p>Java 8ではFiles.lines()でStream&lt;String&gt;としてファイルの内容を取得することが出来ます。</p>
<p>StreamはAutoCloseableを実装しているので、try-with-resourcesを使い、リソースのクローズを行うことが出来ます。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="o">(</span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">lines</span><span class="o">(</span><span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">fullPath</span><span class="o">)))</span> <span class="o">{</span>
        <span class="n">lines</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="id40">
<h4>例題 8<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id40" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>プログラムの実行時引数の第1引数に指定されたテキストファイルの初めの10行を出力するプログラムを作成してください（例外処理は求めません）。</p>
<div class="highlight-bat"><div class="highlight"><pre><span></span>C<span class="p">:</span><span class="nl">\</span><span class="c1">&gt; java Head C:\Users\worksap\hoge.txt</span>
</pre></div>
</div>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock18&#39;))">+ show/hide code</a><br><div id="hiddencodeblock18" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Stream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Head</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">(</span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">lines</span><span class="o">(</span><span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">])))</span> <span class="o">{</span>
                        <span class="n">lines</span>
                                <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="id41">
<h3>要素が条件を満たしている・満たさないを判定する<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id41" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>いままでfor文の中で <code class="docutils literal"><span class="pre">if(...)</span> <span class="pre">{</span> <span class="pre">break;</span> <span class="pre">}</span></code> や <code class="docutils literal"><span class="pre">if</span> <span class="pre">(...)</span> <span class="pre">{</span> <span class="pre">continue;</span> <span class="pre">}</span></code> といった処理をイディオムとして記述していましたが、それらはStream APIのメソッドとして、名前の付いたモノ（かつバグっていないモノ）に置き換えることが出来ます。</p>
<div class="section" id="id42">
<h4>例題 9<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id42" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>次のプログラムは、コミットメッセージに”refs #777”が含まれているかどうかを判定するプログラムです。
areAllValid()メソッドのfor文をStream APIに書き換えてください。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">commitMessages</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                        <span class="s">"refs #100 fix a bug in Main.js"</span><span class="o">,</span>
                        <span class="s">"invalid commit message"</span><span class="o">,</span>
                        <span class="s">"refs #101 add a new future"</span>
        <span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">areAllValid</span><span class="o">(</span><span class="n">commitMessages</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Your commit(s) is accepted"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Malformed commit message(s) is found"</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Pattern</span> <span class="n">COMMIT_MESSAGE_PATTERN</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span>
                <span class="s">"refs\\s+#[0-9]+\\s"</span>
<span class="o">);</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">areAllValid</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">commitMessages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">commitMessage</span> <span class="o">:</span> <span class="n">commitMessages</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(!</span><span class="n">COMMIT_MESSAGE_PATTERN</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">commitMessage</span><span class="o">).</span><span class="na">find</span><span class="o">())</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>** 失敗例 **</p>
<p>JavaScriptでできるからと次のようなコードを書くと、コンパイルエラーになります。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">areAllValid</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">commitMessages</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="n">commitMessages</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">commitMessage</span> <span class="o">-&gt;</span> <span class="o">{</span>
                                <span class="k">if</span> <span class="o">(!</span><span class="n">COMMIT_MESSAGE_PATTERN</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">commitMessage</span><span class="o">).</span><span class="na">find</span><span class="o">())</span> <span class="o">{</span>
                                        <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                                <span class="o">}</span>
                        <span class="o">});</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>ラムダ式、もしくは匿名クラスから外側の変数にアクセスするためには、それらの変数はfinalでなければならないというルールがあります。そのため、finalでないresultにアクセスして、その内容を書き換えることは出来ません。</p>
<p>** 解答例 **</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock19&#39;))">+ show/hide code</a><br><div id="hiddencodeblock19" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">areAllValid</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">commitMessages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">commitMessages</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">allMatch</span><span class="o">(</span><span class="n">commitMessage</span> <span class="o">-&gt;</span>
                        <span class="n">COMMIT_MESSAGE_PATTERN</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">commitMessage</span><span class="o">).</span><span class="na">find</span><span class="o">()</span>
                <span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div><p>** 解説 **</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock20&#39;))">+ show/hide code</a><br><div id="hiddencodeblock20" style="display: none"><div class="highlight-text"><div class="highlight"><pre><span></span>ある要素が○○を満たす、全てが○○を満たす、といった条件を判定したい場合は、
Stream#anyMatch()、Stream#allMatch()     、Stream#noneMatch()を使います。
ド・モルガンの法則より、

        Stream#allMatch(e -&gt; P(e)) == !Stream#anyMatch(e -&gt; !P(e))
        Stream#anyMatch(e -&gt; Q(e)) == !Stream#allMatch(e -&gt; !Q(e))
        Stream#anyMatch(e -&gt; R(e)) == !Stream#noneMatch(e -&gt; R(e))

なので、allMatch()の他、anyMatch()、noneMatch()を使って書き直すことが出来ます。
</pre></div>
</div>
</div><div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>「 COMMIT_MESSAGE_PATTERN.matcher(commitMessage).find() 」の部分は、一見すると何を行っているのか分かり難いので、isValid()のような別名を付けても良いです。</p>
<div class="line-block">
<div class="line"><br></div>
</div>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock21&#39;))">+ show/hide code</a><br><div id="hiddencodeblock21" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">areAllValid</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">commitMessages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">commitMessages</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">allMatch</span><span class="o">(</span><span class="n">isValid</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">isValid</span> <span class="o">=</span>
        <span class="n">commitMessage</span> <span class="o">-&gt;</span> <span class="n">COMMIT_MESSAGE_PATTERN</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">commitMessage</span><span class="o">).</span><span class="na">find</span><span class="o">();</span>
</pre></div>
</div>
</div><script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock22&#39;))">+ show/hide code</a><br><div id="hiddencodeblock22" style="display: none"><div class="last highlight-java"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">areAllValid</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">commitMessages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">commitMessages</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">allMatch</span><span class="o">(</span><span class="n">Main</span><span class="o">::</span><span class="n">isValid</span><span class="o">);</span> <span class="c1">// Suppose the class name is Main</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="n">String</span> <span class="n">commitMessage</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">COMMIT_MESSAGE_PATTERN</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">commitMessage</span><span class="o">).</span><span class="na">find</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="id43">
<h4>例題 10<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id43" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>例題 9のソースコードを、
Stream#allMatch()、Stream#anyMatch()、Stream#noneMatch()の全てをそれぞれ使って書きなおしてください。</p>
<p>** 解答例 **</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock23&#39;))">+ show/hide code</a><br><div id="hiddencodeblock23" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">areAllValid</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">commitMessages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="n">commitMessages</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyMatch</span><span class="o">(</span><span class="n">commitMessage</span> <span class="o">-&gt;</span>
                        <span class="o">!</span><span class="n">COMMIT_MESSAGE_PATTERN</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">commitMessage</span><span class="o">).</span><span class="na">find</span><span class="o">()</span>
                <span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div><script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock24&#39;))">+ show/hide code</a><br><div id="hiddencodeblock24" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">areAllValid</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">commitMessages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">commitMessages</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">noneMatch</span><span class="o">(</span><span class="n">commitMessage</span> <span class="o">-&gt;</span>
                        <span class="o">!</span><span class="n">COMMIT_MESSAGE_PATTERN</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">commitMessage</span><span class="o">).</span><span class="na">find</span><span class="o">()</span>
                <span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div><div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Stream#allMatch()、Stream#anyMatch()、Stream#noneMatch()はショートサーキット動作（結果が確定した時点で反復処理が中断される）が行われます。</p>
</div>
</div>
</div>
</div>
<div class="section" id="testability-with-java-8">
<h2>Testability with Java 8<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#testability-with-java-8" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Java 8のラムダ式を活用したコードは、ソースコードのテスタビリティに貢献する可能性もあります。</p>
<p>ここでは、FizzBuzzプログラムを例にとって解説します。</p>
<p>まず、何も考えずにFizzBuzzプログラムを作成すると次のようになります。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FizzBuzz</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">);</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">);</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">);</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="o">}</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Java 8スタイルで書きなおしてみます。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.stream.IntStream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FizzBuzz</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">IntStream</span><span class="o">.</span><span class="na">rangeClosed</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">).</span><span class="na">boxed</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">::</span><span class="n">fizzBuzz</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">String</span> <span class="nf">fizzBuzz</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"Fizz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"Buzz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"FizzBuzz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>IntStreamの使い方については割愛します。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">IntStream</span><span class="o">.</span><span class="na">rangeClosed</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">).</span><span class="na">boxed</span><span class="o">()</span>
</pre></div>
</div>
<p>と</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="o">...</span> <span class="o">,</span> <span class="mi">100</span><span class="o">).</span><span class="na">stream</span><span class="o">()</span>
</pre></div>
</div>
<p>もしくは</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="o">...</span> <span class="o">,</span> <span class="mi">100</span><span class="o">)</span>
</pre></div>
</div>
<p class="last">とは同等の効果を持ちます（後者の場合は「...」で省略した部分を全部書かないといけませんが）。</p>
</div>
<p>テストは次のようになります。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.junit.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">CoreMatchers</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FizzBuzzTest</span> <span class="o">{</span>
        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzz</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">5</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">15</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">16</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"16"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">18</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">20</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">30</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">));</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">必要に応じてテストメソッド（テストケース）を分割してください。</p>
</div>
<p>プログラムのロジックの部分について、まずはがっちりテストすることが出来るようになりました。</p>
<p>もちろん、ループの境界値をミスる可能性もあるので、必要に応じてfizzBuzzTo()メソッドを切り出すことが出来ます。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.stream.IntStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Stream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FizzBuzz</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">fizzBuzzTo</span><span class="o">(</span><span class="mi">100</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">fizzBuzzTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">to</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">IntStream</span><span class="o">.</span><span class="na">rangeClosed</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">).</span><span class="na">boxed</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">::</span><span class="n">fizzBuzz</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">String</span> <span class="nf">fizzBuzz</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"FizzBuzz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"Fizz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"Buzz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>テストは次のようになります。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.junit.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">CoreMatchers</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FizzBuzzTest</span> <span class="o">{</span>
        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzz</span><span class="o">()</span> <span class="o">{</span>
                <span class="c1">// OMIT</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzzTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzzTo</span><span class="o">(</span><span class="mi">100</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzzTo</span><span class="o">(</span><span class="mi">100</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span> <span class="c1">// start with 1</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzzTo</span><span class="o">(</span><span class="mi">100</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">)));</span> <span class="c1">// ends with 100 (Buzz)</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>ここで追加されたメソッドでは、ループ件数に関するテストとなります。もちろん、Java 7スタイルでも、ループ件数のテストを切り出すことも可能ですし、fizzBuzzTo()の中からfizzBuzz()を抽出することが可能ですが、
Java 8スタイルだと、このような切り出しを行うのに必要なソースコードの量が圧倒的に少なくなる傾向があります。（つまり、テスタブルなソースコードをより書きやすくすること、そしてバグそのものの防止に繋がります）</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p>Streamインスタンスに対する終末処理（count()など）は、1インスタンス当たり1回までしか許されていません。例えば次のコードは例外が発生します。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzzTo</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">fbStream</span> <span class="o">=</span> <span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzzTo</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">fbStream</span><span class="o">.</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">fbStream</span><span class="o">.</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span> <span class="c1">// start with 1</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">fbStream</span><span class="o">.</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">)));</span> <span class="c1">// ends with 100 (Buzz)</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-text"><div class="highlight"><pre><span></span>java.lang.IllegalStateException: stream has already been operated upon or closed
        at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:229)
        at java.util.stream.ReferencePipeline.findFirst(ReferencePipeline.java:464)
        at FizzBuzzTest.test_fizzBuzzTo(FizzBuzzTest.java:29)
        (OMIT)
</pre></div>
</div>
<p>したがって、先に示した通りに書くか、もしくは次のようにListに変換する必要があります。</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzzTo</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">fbList</span> <span class="o">=</span> <span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzzTo</span><span class="o">(</span><span class="mi">100</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">fbList</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100</span><span class="o">));</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">fbList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span> <span class="c1">// start with 1</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">fbList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">99</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span> <span class="c1">// ends with 100 (Buzz)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="strategy-pattern-factory-method-pattern">
<h3>Strategy Pattern &amp; Factory Method Pattern<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#strategy-pattern-factory-method-pattern" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>さてここで機能拡張要件が発生しました。</p>
<ul class="simple">
<li>第1引数で”FizzBuzz”が指定されたらFizzBuzzを、”Nabeatsu”が指定されたら「世界のナベアツ」を実行するように</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">実際の製品開発だったらば、フラグの追加で計算式を分けることはあるあるですよね？</p>
</div>
<p>Java 8ならば簡単に機能追加が出来ます。そう、Java 8ならば。</p>
<p>まずはリファクタリングしてから、</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.function.Function</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.IntStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Stream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FizzBuzz</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">FizzBuzz</span><span class="o">::</span><span class="n">fizzBuzz</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">applyTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">to</span><span class="o">,</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">algorhythm</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">IntStream</span><span class="o">.</span><span class="na">rangeClosed</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">).</span><span class="na">boxed</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">algorhythm</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">String</span> <span class="nf">fizzBuzz</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"FizzBuzz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"Fizz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"Buzz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Function&lt;T, R&gt;は1引数の関数を表現する関数型インターフェイスです。fizzBuzz()メソッドは、この要件を満たしているので、「FizzBuzz::fizzBuzz」とすることで、Functionインターフェイスに代入可能なラムダ式を生成することが出来ます。</p>
</div>
<p>ナベアツメソッドを作って、</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">static</span> <span class="n">String</span> <span class="nf">nabeatsu</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="s">"aho"</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">contains3</span><span class="o">(</span><span class="n">i</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">return</span> <span class="s">"aho"</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">contains3</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">chars</span><span class="o">().</span><span class="na">anyMatch</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">==</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="sc">'3'</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>ファクトリメソッドを用意して、</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">static</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">getAlgorhythm</span><span class="o">(</span><span class="n">String</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span><span class="o">(</span><span class="n">param</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">case</span> <span class="s">"FizzBuzz"</span><span class="o">:</span> <span class="k">return</span> <span class="n">FizzBuzz</span><span class="o">::</span><span class="n">fizzBuzz</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">"Nabeatsu"</span><span class="o">:</span> <span class="k">return</span> <span class="n">FizzBuzz</span><span class="o">::</span><span class="n">nabeatsu</span><span class="o">;</span>
                <span class="k">default</span><span class="o">:</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">"No algorhythm found: "</span> <span class="o">+</span> <span class="n">param</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>main()メソッドを書き換えます</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">getAlgorhythm</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]))</span>
                        <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>全体のソースコードは次の通り</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.function.Function</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.IntStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Stream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FizzBuzz</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">getAlgorhythm</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]))</span>
                                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">applyTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">to</span><span class="o">,</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">algorhythm</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">IntStream</span><span class="o">.</span><span class="na">rangeClosed</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">).</span><span class="na">boxed</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">algorhythm</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">getAlgorhythm</span><span class="o">(</span><span class="n">String</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">param</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">case</span> <span class="s">"FizzBuzz"</span><span class="o">:</span> <span class="k">return</span> <span class="n">FizzBuzz</span><span class="o">::</span><span class="n">fizzBuzz</span><span class="o">;</span>
                        <span class="k">case</span> <span class="s">"Nabeatsu"</span><span class="o">:</span> <span class="k">return</span> <span class="n">FizzBuzz</span><span class="o">::</span><span class="n">nabeatsu</span><span class="o">;</span>
                        <span class="k">default</span><span class="o">:</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">"No algorhythm found: "</span> <span class="o">+</span> <span class="n">param</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">String</span> <span class="nf">fizzBuzz</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"FizzBuzz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"Fizz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"Buzz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">String</span> <span class="nf">nabeatsu</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"aho"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">contains3</span><span class="o">(</span><span class="n">i</span><span class="o">))</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"aho"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">contains3</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">chars</span><span class="o">().</span><span class="na">anyMatch</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">==</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="sc">'3'</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>簡単に書けたので、テストも書いちゃうよー</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.junit.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">CoreMatchers</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FizzBuzzTest</span> <span class="o">{</span>
        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzz</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">FizzBuzz</span> <span class="n">fb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FizzBuzz</span><span class="o">();</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">5</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">15</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">16</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"16"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">18</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">20</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">(</span><span class="mi">30</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsu</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">FizzBuzz</span> <span class="n">fb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FizzBuzz</span><span class="o">();</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"2"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">(</span><span class="mi">6</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">(</span><span class="mi">13</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">(</span><span class="mi">31</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzzTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">FizzBuzz</span> <span class="n">fb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FizzBuzz</span><span class="o">();</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">FizzBuzz</span><span class="o">::</span><span class="n">fizzBuzz</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">FizzBuzz</span><span class="o">::</span><span class="n">fizzBuzz</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span> <span class="c1">// start with 1</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">fb</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">FizzBuzz</span><span class="o">::</span><span class="n">fizzBuzz</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">)));</span> <span class="c1">// ends with 100 (Buzz)</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsuTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">98</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"aho"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"100"</span><span class="o">)));</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>あとは、getAlgorythm()のテストですが、</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_getAlgorythm</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">::</span><span class="n">fizzBuzz</span><span class="o">));</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"Nabeatsu"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">::</span><span class="n">nabeatsu</span><span class="o">));</span>
<span class="o">}</span>
</pre></div>
</div>
<p>はパスしません。以下のようなエラーが出ます。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span>java.lang.AssertionError:
Expected: is &lt;FizzBuzzTest$$Lambda$2/463345942@759ebb3d&gt;
                 but: was &lt;FizzBuzz$$Lambda$1/1724731843@484b61fc&gt;
</pre></div>
</div>
<p>バイトコードレベルでは同じラムダ式でも、別物として認識されてしまっているようです。</p>
<p>ならば、staticメソッドをstaticフィールド（Function型）に書き換えてやろう。</p>
<p>やることは以下の通り。</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Before</th>
<th class="head">After</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>static String xxx(int i) { ... }</td>
<td>static final Function&lt;String, Integer&gt; xxx = i -&gt; { ... };</td>
<td>ラムダ式のブロックステートメントに書き直します。「final」を忘れずに！なお、ラムダ式を使う場合、<code class="docutils literal"><span class="pre">this</span></code> はインスタンスを指すので、全ての場合で機械的に置き換えることが出来ます（匿名クラスを使う場合は、<code class="docutils literal"><span class="pre">this</span></code> が匿名クラスのインスタンスを指すので、注意が必要です）。</td>
</tr>
<tr class="row-odd"><td>FizzBuzz::xxx</td>
<td>FizzBuzz.xxx</td>
<td>staticフィールドがそのままラムダ式なので、「::」は不要です</td>
</tr>
<tr class="row-even"><td>FizzBuzz.xxx(a)</td>
<td>FizzBuzz.xxx.apply(a)</td>
<td>JavaScriptとは違って、メソッドとFunctionとは別物です</td>
</tr>
</tbody>
</table>
<p>を機械的に書き換えるだけです。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.function.Function</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.IntStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Stream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FizzBuzz</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">getAlgorhythm</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]))</span>
                                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">applyTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">to</span><span class="o">,</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">algorhythm</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">IntStream</span><span class="o">.</span><span class="na">rangeClosed</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">).</span><span class="na">boxed</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">algorhythm</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">getAlgorhythm</span><span class="o">(</span><span class="n">String</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">param</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">case</span> <span class="s">"FizzBuzz"</span><span class="o">:</span> <span class="k">return</span> <span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">;</span>
                        <span class="k">case</span> <span class="s">"Nabeatsu"</span><span class="o">:</span> <span class="k">return</span> <span class="n">FizzBuzz</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">;</span>
                        <span class="k">default</span><span class="o">:</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">"No algorhythm found: "</span> <span class="o">+</span> <span class="n">param</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">fizzBuzz</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"FizzBuzz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"Fizz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"Buzz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">};</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">nabeatsu</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"aho"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">contains3</span><span class="o">(</span><span class="n">i</span><span class="o">))</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"aho"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">};</span>

        <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">contains3</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">chars</span><span class="o">().</span><span class="na">anyMatch</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">==</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="sc">'3'</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>これでgetAlgorythm()のテストも出来るようになります。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.junit.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">CoreMatchers</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FizzBuzzTest</span> <span class="o">{</span>
        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzz</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">5</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">15</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">16</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"16"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">18</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">20</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">30</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsu</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"2"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">6</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">13</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">31</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzzTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span> <span class="c1">// start with 1</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">)));</span> <span class="c1">// ends with 100 (Buzz)</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsuTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">98</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"aho"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"100"</span><span class="o">)));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_idTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"100"</span><span class="o">)));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_getAlgorythm</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"Nabeatsu"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">FizzBuzz</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">));</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>ね、簡単でしょう？</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>Java 7で同等のことを行う場合は、Algorythmインターフェイスを用意して、実装クラスFizzBuzz、Nabeatsuを用意することになります。機能拡張案件が来た時点でリファクタリングを行うのは非常に面倒な作業になります。</p>
<p>かといって、予め拡張性を意識した設計をとAlgorythmインターフェイスにFizzBuzzクラスを設計した場合、もし機能拡張案件が来なかったら、それはただの過剰設計で終わってしまいます。</p>
<p class="last">Java 8のラムダ式は機能拡張案件に柔軟に対応する強力なツールとなります。是非活用してください。</p>
</div>
<div class="section" id="id44">
<h4>例題 11<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id44" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>このプログラムに次の機能を実装してください。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">もはやFizzBuzzではないので、Mainクラスにでも改名してください。</p>
</div>
<p><strong>(1)</strong> 第1引数で”Id”が指定されたら、1, 2, 3,... を「そのまま」表示する機能</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>&gt; java Main Id
1
2
3
4
5

(OMIT)
</pre></div>
</div>
<p><strong>(2)</strong> 第1引数で”Nabeatsu2”が指定されたら、「3の倍数と3がつく数だけをそのまま」表示する機能</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>&gt; java Main Nabeatsu2
3
6
9
12
13
15

(OMIT)
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">もちろん、既存の機能は動作しなければなりません。また、きちんと単体テストを書いてくださいね。</p>
</div>
<p><strong>【解答例】</strong></p>
<p><strong>(1)</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock25&#39;))">+ show/hide code</a><br><div id="hiddencodeblock25" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.function.Function</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.IntStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Stream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">getAlgorhythm</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]))</span>
                                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">applyTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">to</span><span class="o">,</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">algorhythm</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">IntStream</span><span class="o">.</span><span class="na">rangeClosed</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">).</span><span class="na">boxed</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">algorhythm</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">getAlgorhythm</span><span class="o">(</span><span class="n">String</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">param</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">case</span> <span class="s">"FizzBuzz"</span><span class="o">:</span> <span class="k">return</span> <span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">;</span>
                        <span class="k">case</span> <span class="s">"Nabeatsu"</span><span class="o">:</span> <span class="k">return</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">;</span>
                        <span class="k">case</span> <span class="s">"Id"</span><span class="o">:</span> <span class="k">return</span> <span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
                        <span class="k">default</span><span class="o">:</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">"No algorhythm found: "</span> <span class="o">+</span> <span class="n">param</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">fizzBuzz</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"FizzBuzz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"Fizz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"Buzz"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">};</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">nabeatsu</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"aho"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">contains3</span><span class="o">(</span><span class="n">i</span><span class="o">))</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="s">"aho"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">};</span>

        <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">contains3</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">chars</span><span class="o">().</span><span class="na">anyMatch</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">==</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="sc">'3'</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">id</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div><script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock26&#39;))">+ show/hide code</a><br><div id="hiddencodeblock26" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">CoreMatchers</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainTest</span> <span class="o">{</span>
        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzz</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">5</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">15</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">16</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"16"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">18</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">20</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">30</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsu</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"2"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">6</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">13</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">31</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_id</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">100</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"100"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzzTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span> <span class="c1">// start with 1</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">)));</span> <span class="c1">// ends with 100 (Buzz)</span>
        <span class="o">}</span>


        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsuTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">98</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"aho"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"100"</span><span class="o">)));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_getAlgorythm</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"Nabeatsu"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"Id"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">));</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div><p><strong>(2)</strong></p>
<p>解説</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock27&#39;))">+ show/hide code</a><br><div id="hiddencodeblock27" style="display: none"><div class="highlight-text"><div class="highlight"><pre><span></span>(2)の機能拡張では、applyTo()メソッドに.filter()を追加することで対応できます。
この時、アルゴリズム"FizzBuzz"、"Nabeatsu"、"Id"では.filter()条件を設定しない（恒等true）ようにすれば良いことになります。
getAlgothythm()メソッドでは、applyTo()内のmap()に喰わせる部分だけを返却していましたが、
ここに追加されたfilter()に喰わせる部分もセットで返却する必要があります。

まずはリファクタリングです。filter()に喰わせる部分（filter）とmap()に喰わせる部分（converter）をセットにした
Algorhythmクラスを作成します。filterの型はFunction&lt;Integer, Boolean&gt;ではなく、Predicate&lt;Integer&gt;です
（代入互換性はありませんが、ラムダ式として見れば両者は同じものです）。
"FizzBuzz"、"Nabeatsu"、"Id"のfilterは全て``i -&gt; true``です。
</pre></div>
</div>
</div><p>リファクタリング</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock28&#39;))">+ show/hide code</a><br><div id="hiddencodeblock28" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.function.Function</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.function.Predicate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.IntStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Stream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">getAlgorhythm</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]))</span>
                                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">applyTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">to</span><span class="o">,</span> <span class="n">Algorhythm</span> <span class="n">algorhythm</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">IntStream</span><span class="o">.</span><span class="na">rangeClosed</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">).</span><span class="na">boxed</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">algorhythm</span><span class="o">.</span><span class="na">filter</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">algorhythm</span><span class="o">.</span><span class="na">converter</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Algorhythm</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">filter</span><span class="o">;</span>
                <span class="kd">final</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">converter</span><span class="o">;</span>

                <span class="n">Algorhythm</span><span class="o">(</span><span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">filter</span><span class="o">,</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">converter</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">this</span><span class="o">.</span><span class="na">filter</span> <span class="o">=</span> <span class="n">filter</span><span class="o">;</span>
                        <span class="k">this</span><span class="o">.</span><span class="na">converter</span> <span class="o">=</span> <span class="n">converter</span><span class="o">;</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">Algorhythm</span> <span class="nf">getAlgorhythm</span><span class="o">(</span><span class="n">String</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">param</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">case</span> <span class="s">"FizzBuzz"</span><span class="o">:</span> <span class="k">return</span> <span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">;</span>
                        <span class="k">case</span> <span class="s">"Nabeatsu"</span><span class="o">:</span> <span class="k">return</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">;</span>
                        <span class="k">case</span> <span class="s">"Id"</span><span class="o">:</span> <span class="k">return</span> <span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
                        <span class="k">default</span><span class="o">:</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">"No algorhythm found: "</span> <span class="o">+</span> <span class="n">param</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="n">Algorhythm</span> <span class="n">fizzBuzz</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Algorhythm</span><span class="o">(</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="kc">true</span><span class="o">,</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="s">"FizzBuzz"</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="s">"Fizz"</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="s">"Buzz"</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="o">}</span>
                <span class="o">}</span>
        <span class="o">);</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="n">Algorhythm</span> <span class="n">nabeatsu</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Algorhythm</span><span class="o">(</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="kc">true</span><span class="o">,</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="s">"aho"</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">contains3</span><span class="o">(</span><span class="n">i</span><span class="o">))</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="s">"aho"</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="o">}</span>
                <span class="o">}</span>
        <span class="o">);</span>

        <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">contains3</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">chars</span><span class="o">().</span><span class="na">anyMatch</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">==</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="sc">'3'</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="n">Algorhythm</span> <span class="n">id</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Algorhythm</span><span class="o">(</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="kc">true</span><span class="o">,</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">)</span>
        <span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div><script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock29&#39;))">+ show/hide code</a><br><div id="hiddencodeblock29" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">CoreMatchers</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainTest</span> <span class="o">{</span>
        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzz_converter</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">5</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">15</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">16</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"16"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">18</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">20</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">30</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsu_converter</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"2"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">6</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">13</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">31</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_id_converter</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">100</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"100"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzzTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span> <span class="c1">// start with 1</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">)));</span> <span class="c1">// ends with 100 (Buzz)</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsuTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">98</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"aho"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"100"</span><span class="o">)));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_idTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"100"</span><span class="o">)));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_getAlgorythm</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"Nabeatsu"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"Id"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">));</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div><p>解答例</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock30&#39;))">+ show/hide code</a><br><div id="hiddencodeblock30" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.function.Function</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.function.Predicate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.IntStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Stream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">getAlgorhythm</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]))</span>
                                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">applyTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">to</span><span class="o">,</span> <span class="n">Algorhythm</span> <span class="n">algorhythm</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">IntStream</span><span class="o">.</span><span class="na">rangeClosed</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">).</span><span class="na">boxed</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">algorhythm</span><span class="o">.</span><span class="na">filter</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">algorhythm</span><span class="o">.</span><span class="na">converter</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Algorhythm</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">filter</span><span class="o">;</span>
                <span class="kd">final</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">converter</span><span class="o">;</span>

                <span class="n">Algorhythm</span><span class="o">(</span><span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">filter</span><span class="o">,</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">converter</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">this</span><span class="o">.</span><span class="na">filter</span> <span class="o">=</span> <span class="n">filter</span><span class="o">;</span>
                        <span class="k">this</span><span class="o">.</span><span class="na">converter</span> <span class="o">=</span> <span class="n">converter</span><span class="o">;</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="n">Algorhythm</span> <span class="nf">getAlgorhythm</span><span class="o">(</span><span class="n">String</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">param</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">case</span> <span class="s">"FizzBuzz"</span><span class="o">:</span> <span class="k">return</span> <span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">;</span>
                        <span class="k">case</span> <span class="s">"Nabeatsu"</span><span class="o">:</span> <span class="k">return</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">;</span>
                        <span class="k">case</span> <span class="s">"Id"</span><span class="o">:</span> <span class="k">return</span> <span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
                        <span class="k">case</span> <span class="s">"Nabeatsu2"</span><span class="o">:</span> <span class="k">return</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">;</span>
                        <span class="k">default</span><span class="o">:</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">"No algorhythm found: "</span> <span class="o">+</span> <span class="n">param</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="n">Algorhythm</span> <span class="n">fizzBuzz</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Algorhythm</span><span class="o">(</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="kc">true</span><span class="o">,</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="s">"FizzBuzz"</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="s">"Fizz"</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="s">"Buzz"</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="o">}</span>
                <span class="o">}</span>
        <span class="o">);</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="n">Algorhythm</span> <span class="n">nabeatsu</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Algorhythm</span><span class="o">(</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="kc">true</span><span class="o">,</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="s">"aho"</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">contains3</span><span class="o">(</span><span class="n">i</span><span class="o">))</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="s">"aho"</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="o">}</span>
                <span class="o">}</span>
        <span class="o">);</span>

        <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">contains3</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">chars</span><span class="o">().</span><span class="na">anyMatch</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">==</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="sc">'3'</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="n">Algorhythm</span> <span class="n">id</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Algorhythm</span><span class="o">(</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="kc">true</span><span class="o">,</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">)</span>
        <span class="o">);</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="n">Algorhythm</span> <span class="n">nabeatsu2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Algorhythm</span><span class="o">(</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">contains3</span><span class="o">(</span><span class="n">i</span><span class="o">))</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="o">}</span>
                <span class="o">},</span>
                <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">)</span>
        <span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div><script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById(&#39;hiddencodeblock31&#39;))">+ show/hide code</a><br><div id="hiddencodeblock31" style="display: none"><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">CoreMatchers</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainTest</span> <span class="o">{</span>
        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzz_converter</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">5</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">15</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">16</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"16"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">18</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Fizz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">20</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">30</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsu_converter</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"2"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">6</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">13</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">31</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"aho"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_id_converter</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"1"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">100</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"100"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsu2_converter</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"3"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">6</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"6"</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">13</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">"13"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsu2_filter</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">.</span><span class="na">filter</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="kc">false</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">.</span><span class="na">filter</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">.</span><span class="na">filter</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="mi">6</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">.</span><span class="na">filter</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="kc">false</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">.</span><span class="na">filter</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="mi">13</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">.</span><span class="na">filter</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="mi">31</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">.</span><span class="na">filter</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="mi">33</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">.</span><span class="na">filter</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="mi">100</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="kc">false</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_fizzBuzzTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span> <span class="c1">// start with 1</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"Buzz"</span><span class="o">)));</span> <span class="c1">// ends with 100 (Buzz)</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsuTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">98</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"aho"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"100"</span><span class="o">)));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_idTo</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">100L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"1"</span><span class="o">)));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">99</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"100"</span><span class="o">)));</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_nabeatsu2To</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">).</span><span class="na">count</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">45L</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"3"</span><span class="o">)));</span> <span class="c1">// start with 3 (aho)</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">).</span><span class="na">skip</span><span class="o">(</span><span class="mi">44</span><span class="o">).</span><span class="na">findFirst</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"99"</span><span class="o">)));</span> <span class="c1">// ends with 99 (aho)</span>
        <span class="o">}</span>

        <span class="nd">@Test</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_getAlgorythm</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"FizzBuzz"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">fizzBuzz</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"Nabeatsu"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"Id"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">id</span><span class="o">));</span>
                <span class="n">assertThat</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">getAlgorhythm</span><span class="o">(</span><span class="s">"Nabeatsu2"</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">nabeatsu2</span><span class="o">));</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div></div>
</div>
</div>
<div class="section" id="id45">
<h2>日付時刻の取り扱い<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id45" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ここでは、Java 8で導入された日付時刻APIについて解説します。</p>
<div class="section" id="id46">
<h3>追加された主なクラス<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id46" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Java 8 から java.time パッケージに追加された以下の４つのクラスを中心に説明していきます。</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>LocalDate</td>
<td>年月日の情報を持つクラス</td>
</tr>
<tr class="row-even"><td>LocalTime</td>
<td>時分秒の情報を持つクラス</td>
</tr>
<tr class="row-odd"><td>LocalDateTime</td>
<td>年月日時分秒の情報を持つクラス</td>
</tr>
<tr class="row-even"><td>OffsetDateTime</td>
<td>標準時からの時差情報を持つ年月日時分秒を持つクラス</td>
</tr>
</tbody>
</table>
<p>これらのクラスは imutable で、一度値をセットしたら変わりません。値が変更可能な日付型はこれまでも様々な場所で問題を起こしてきて、プロダクト自作の imutable Date などがありましたが、代わりに LocalDate / LocalTime / LocalDateTime を使うように変えていきましょう。また、immutable なので、以下のように値を加算して日付を進めたつもりになっても元のインスタンスの値は変わりません。このあたり、BigDecimal と同じだと考えて下さい。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// NG : oldDate never change</span>
<span class="n">LocalDate</span> <span class="n">oldDate</span> <span class="o">=</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
<span class="n">oldDate</span><span class="o">.</span><span class="na">plusDays</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>

<span class="c1">// OK : use return (new) instance</span>
<span class="n">LocalDate</span> <span class="n">newDate</span> <span class="o">=</span> <span class="n">oldDate</span><span class="o">.</span><span class="na">plusDays</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
</pre></div>
</div>
<p>ZonedDateTime とよく似たクラス OffsetDateTime も導入されています。これらは差がよく分からないかもしれません。OffsetDateTime は時差までしか扱いませんが ZonedDateTime ではタイムゾーンの性質まで引継ぎます。具体的にはサマータイムに対応しています。</p>
<p>この性質をふまえて COMPANY での用途を考えると</p>
<ul class="simple">
<li>全体で日時を共有する日時型：ZonedDateTime</li>
<li>日付だけが重要になるもの：LocalDate</li>
<li>時間だけが重要になるもの：LocalTime</li>
</ul>
<p>となるでしょうか。とはいえ、たとえば支払日のような一見日付だけが重要に思える情報も、キャッシュフローと国際化の観点から考えると、「日本時間の X月 Y日（15時）」のように保持しておいて、残り時間やタイミングが知りたい場合には知れるような構造が望ましいでしょうから、ほとんどの日付時刻型情報は ZonedDateTime で取り扱うことになるでしょう。</p>
</div>
<div class="section" id="now">
<h3>now() ファクトリーメソッド<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#now" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>これらのクラスはいずれも now() ファクトリーメソッドが用意されています。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">LocalDate</span> <span class="n">date</span> <span class="o">=</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
<span class="n">LocalTime</span> <span class="n">time</span> <span class="o">=</span> <span class="n">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
<span class="n">LocalDateTime</span> <span class="n">dateTime</span> <span class="o">=</span> <span class="n">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
<span class="n">ZonedDateTime</span> <span class="n">zonedDateTime</span> <span class="o">=</span> <span class="n">ZonedDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
</pre></div>
</div>
<p>ほとんど問題ないかと思いますが、ZonedDateTime の now を補足すると、このファクトリーメソッドはデフォルトのタイムゾーンの現在の日時を作成します。デフォルトのタイムゾーンは TimeZone.getDefault() で取得される値になります。これで問題がある場合、標準時で取得したい場合には Clock を指定した now() を使う必要があります。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">ZonedDateTime</span> <span class="n">zonedDateTime</span> <span class="o">=</span> <span class="n">ZonedDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">(</span><span class="n">Clock</span><span class="o">.</span><span class="na">systemUTC</span><span class="o">());</span>
</pre></div>
</div>
</div>
<div class="section" id="id47">
<h3>任意の日時の作成<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id47" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>任意の日時のインスタンスを作るには of() ファクトリーメソッドを使います。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">LocalDate</span> <span class="n">date</span> <span class="o">=</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2015</span><span class="o">,</span> <span class="n">Month</span><span class="o">.</span><span class="na">MARCH</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
<span class="n">LocalTime</span> <span class="n">time</span> <span class="o">=</span> <span class="n">LocalTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="n">LocalTime</span> <span class="n">timeNSec</span> <span class="o">=</span> <span class="n">LocalTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">);</span>
<span class="n">LocalDateTime</span> <span class="n">dateTime</span> <span class="o">=</span> <span class="n">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2015</span><span class="o">,</span> <span class="n">Month</span><span class="o">.</span><span class="na">MARCH</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="n">LocalDateTime</span> <span class="n">fromDateAndTime</span> <span class="o">=</span> <span class="n">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">date</span><span class="o">,</span> <span class="n">time</span><span class="o">);</span>
<span class="n">ZonedDateTime</span> <span class="n">zonedDateTime</span> <span class="o">=</span> <span class="n">ZonedDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2015</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">,</span> <span class="n">ZoneId</span><span class="o">.</span><span class="na">systemDefault</span><span class="o">());</span>
<span class="n">ZonedDateTime</span> <span class="n">fromLocalDateTime</span> <span class="o">=</span> <span class="n">ZonedDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">dateTime</span><span class="o">,</span> <span class="n">ZoneId</span><span class="o">.</span><span class="na">systemDefault</span><span class="o">());</span>
</pre></div>
</div>
<ul class="simple">
<li>月は 1月を 1 でセットできますが月を表す列挙形 Month を積極的に使っていきましょう</li>
<li>LocalTime.of() の第４引数はナノ秒です。ミリ秒は無いので気をつけましょう。</li>
<li>ZonedDateTime.of() はすべてのフィールドを埋め、月に Month を使わず、ZoneId を指定しないと作れません（LocalDateTime 作って変換するほうが楽かもしれません）</li>
</ul>
<p>なお、Calendar.JANUARY は相変わらず 0 でこれは int なので以下のように書けてしまいます。気をつけましょう。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">LocalDate</span> <span class="n">dateOK</span> <span class="o">=</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2015</span><span class="o">,</span> <span class="n">Month</span><span class="o">.</span><span class="na">MARCH</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>       <span class="c1">// 2015-03-01</span>
<span class="n">LocalDate</span> <span class="n">dateNG</span> <span class="o">=</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2015</span><span class="o">,</span> <span class="n">Calendar</span><span class="o">.</span><span class="na">MARCH</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>    <span class="c1">// 2015-02-01</span>
</pre></div>
</div>
</div>
<div class="section" id="id48">
<h3>文字列からの生成<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id48" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>悪名高いスレッドセーフでない SimpleDateFormat に代わり、比較的使いやすくスレッドセーフな DateTimeFormatter が使えます。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">DateTimeFormatter</span> <span class="n">formatter</span> <span class="o">=</span> <span class="n">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="s">"yyyy/MM/dd"</span><span class="o">);</span>
<span class="n">LocalDate</span> <span class="n">fromString</span> <span class="o">=</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2015/03/01"</span><span class="o">,</span> <span class="n">formatter</span><span class="o">);</span>
</pre></div>
</div>
<p>日付書式の文字はどの文字が何の意味だっけ？　という場合、DateTimeFormatterBuilder を使ってみましょう。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">DateTimeFormatter</span> <span class="n">formatter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DateTimeFormatterBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">appendValue</span><span class="o">(</span><span class="n">ChronoField</span><span class="o">.</span><span class="na">YEAR</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendLiteral</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendValue</span><span class="o">(</span><span class="n">ChronoField</span><span class="o">.</span><span class="na">MONTH_OF_YEAR</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendLiteral</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendValue</span><span class="o">(</span><span class="n">ChronoField</span><span class="o">.</span><span class="na">DAY_OF_MONTH</span><span class="o">)</span>
                <span class="o">.</span><span class="na">toFormatter</span><span class="o">();</span>
<span class="n">LocalDate</span> <span class="n">fromString</span> <span class="o">=</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2015/03/01"</span><span class="o">,</span> <span class="n">formatter</span><span class="o">);</span>
</pre></div>
</div>
<p>ChronoField の JavaDoc コメントはそれなりに親切なので、きっと役に立つと思います。</p>
</div>
<div class="section" id="id49">
<h3>文字列への変換<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id49" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>toString メソッドに DateTimeFormatter を渡す事で、整形された形式で出力することができます。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">DateTimeFormatter</span> <span class="n">formatter</span> <span class="o">=</span> <span class="n">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="s">"yyyy/MM/dd"</span><span class="o">);</span>
<span class="n">LocalDate</span> <span class="n">localDate</span> <span class="o">=</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
<span class="n">localDate</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">formatter</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="date">
<h3>Date 型との変換<a class="headerlink" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#date" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>LocalXxxx 型は実際のところエポック値（ある決められた日時からどれくらい経過しているかを表す情報）を保持していないため、Date 型との変換は以下のように、一度 ZonedDateTime を介して行うとよいでしょう。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Date</span> <span class="n">oldDate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
<span class="n">ZonedDateTime</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">oldDate</span><span class="o">.</span><span class="na">toInstant</span><span class="o">().</span><span class="na">atZone</span><span class="o">(</span><span class="n">ZoneId</span><span class="o">.</span><span class="na">systemDefault</span><span class="o">());</span>
<span class="n">LocalDate</span> <span class="n">localDate</span> <span class="o">=</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">temp</span><span class="o">);</span>
<span class="n">LocalDate</span> <span class="n">toLocalDate</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="na">toLocalDate</span><span class="o">();</span>
<span class="n">LocalTime</span> <span class="n">localTime</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="na">toLocalTime</span><span class="o">();</span>
<span class="n">LocalTime</span> <span class="n">toLocalTime</span> <span class="o">=</span> <span class="n">LocalTime</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">temp</span><span class="o">);</span>
<span class="n">LocalDateTime</span> <span class="n">localDateTime</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="na">toLocalDateTime</span><span class="o">();</span>
<span class="n">LocalDateTime</span> <span class="n">toLocalDateTime</span> <span class="o">=</span> <span class="n">LocalDateTime</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">temp</span><span class="o">);</span>
</pre></div>
</div>
<p>LocalXxxx.from / ZonedDateTime.toLocalXxxx のどちらを使っても構いません。</p>
<p>逆に変換する場合にも ZonedDateTime を経由するのが分かりやすいです。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">LocalDateTime</span> <span class="n">newDate</span> <span class="o">=</span> <span class="n">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
<span class="n">ZonedDateTime</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">ZonedDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">newDate</span><span class="o">,</span> <span class="n">ZoneId</span><span class="o">.</span><span class="na">systemDefault</span><span class="o">());</span>
<span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="n">Date</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">temp</span><span class="o">.</span><span class="na">toInstant</span><span class="o">());</span>
</pre></div>
</div>
</div>
</div>
</div>


      </main><nav class="related-nav" aria-label="related navigation">

  <ul class="breadcrumb-list">
    <li>
      <a href="https://webootcamp.worksap.co.jp/course/ss-i/ja/index.html">Bootcamp ServerSide Intermediate - latest</a>
    </li>
  </ul>

</nav>
    </div>
    <div class="right">

<nav class="sidebar" aria-label="main navigation"><section class="side-widget localtoc">
  <h3>目次</h3>
  <div class="side-widget-content">
    <ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#">Java8</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id1">ラムダ式</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id2">ラムダ式の書き方・発展編</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id3">例</a></li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id4">ラムダ式と匿名クラスの違い</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id5">関数型インターフェイスの作り方</a></li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#sqlstream-api">SQLに学ぶStream APIとコレクション操作</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#stream">Stream の概要</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id8">解説</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#template-of-convertion-of-list-to-list-listlist">Template of convertion of List to List / List→Listのテンプレート</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#where">WHERE / 条件を絞る</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#sql-style">SQL Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#java-8-style">Java 8 Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#old-java-style">Old Java Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id15">例題 1</a></li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#order-by">ORDER BY / 要素を順に並べかえる</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id16">SQL Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id17">Java 8 Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id18">例題 2</a></li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#select-column-dto">SELECT column / DTOから別の値に</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id19">SQL Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id20">Java 8 Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id21">例題 3</a></li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id22">集計関数</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#count">COUNT(*)</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#max-min">MAX(*), MIN(*)</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#n">初めのn件</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#sum">SUM(*)</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id23">例題 4</a></li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#map">結果をMapで取得する</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id24">Java 8 Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id25">Old Java Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id26">例題 5</a></li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#group-by">GROUP BY</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id27">SQL Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id28">Java 8 Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id29">例題 6</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id30">実例紹介</a></li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#inner-join-with-unique-key">INNER JOIN (with unique key)</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id31">SQL Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id32">Java 8 Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id33">例題 7</a></li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#cross-join">CROSS JOIN</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id34">SQL Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id35">Java 8 Style</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#forstream-api">for文をStream APIに書き換える</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id36">コレクションの内容を一行ずつ表示する</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#old-style">Old Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#new-style">New Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id37">Old Style</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id38">New Style</a></li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#iterator-iterable-stream">Iterator / Iterable から Stream を生成する</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id39">ファイルの中身を1行ずつ表示する</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id40">例題 8</a></li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id41">要素が条件を満たしている・満たさないを判定する</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id42">例題 9</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id43">例題 10</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#testability-with-java-8">Testability with Java 8</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#strategy-pattern-factory-method-pattern">Strategy Pattern &amp; Factory Method Pattern</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id44">例題 11</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id45">日付時刻の取り扱い</a><ul>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id46">追加された主なクラス</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#now">now() ファクトリーメソッド</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id47">任意の日時の作成</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id48">文字列からの生成</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#id49">文字列への変換</a></li>
<li><a class="reference internal" href="https://webootcamp.worksap.co.jp/course/ss-i/ja/java8.html#date">Date 型との変換</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
</section>
<section class="side-widget searchbox" role="search">
  <h3>クイック検索</h3>
  <div class="side-widget-content">
    <form class="search" action="https://webootcamp.worksap.co.jp/course/ss-i/ja/search.html" method="get">
      <input type="text" name="q">
      <input type="submit" value="検索">
      <input type="hidden" name="check_keywords" value="yes">
      <input type="hidden" name="area" value="default">
    </form>
    <p class="searchtip">
      モジュール、クラス、または関数名を入力してください
    </p>
  </div>
</section>
<div role="note" aria-label="source link" class="side-widget source-link">
  
  <div class="side-widget-content">
    <a href="https://webootcamp.worksap.co.jp/course/ss-i/ja/_sources/java8.txt" rel="nofollow">ソースコードを表示</a>
  </div>
</div>

</nav>
    </div>
  </div><footer id="global-footer">
      © Copyright 2016, Works Applications Co., Ltd..
    このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8 で生成しました。
</footer>


</body></html>